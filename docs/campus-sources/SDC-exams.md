# 《计算机组成与设计》部分历年题目题解

## 19-20年

### 一、选择题（共 10 小题，每小题 3 分，共 30 分）

1.以下 MIPS 寄存器中，用来存放返回地址的寄存器是：（）

   A、`$a0-$a3`

   B、`$v0-$v1`

   C、`$ra`

   D、`$sp`

> C。`ra` 寄存器是存放返回地址的寄存器，常配合 `jal` 指令使用。
>
> `a0`-`a3` 为**参数寄存器**，用于存放调用函数的**参数**
>
> `v0`-`v1` 为**值寄存器**，用于存放函数的**返回值**。
>
> `sp` 为**栈指针**，指向栈顶。

2.假定执行一条指令最多划分为 IF、ID、EX、MEM、WB 等 5 个阶段，各阶段时间分别为：IF 阶段 180ps，ID 阶段 150ps，EX 阶段 200ps，MEM 阶段 220ps，WB 阶段 150ps，对于指令 ADDI `$t1,$t2, 20`，分别按照单周期方式、多周期方式、流水线方式执行，则执行该单条指令花费总时间最少的方式是：（）

   A、单周期方式

   B、多周期方式

   C、流水线方式

   D、不确定

> A。
>
> 单周期方式：总执行时间由**耗时最长的数据通路决定**，因此耗时是 MEM 段对应的 220ps。
>
> 多周期方式：每一个阶段对应一个周期，因此耗时为所有执行时间之和。
>
> 流水线方式：周期时间为耗时最长的数据通路，因此耗时为 220*5ps
>
> 注意本题说的是执行单条指令，因此流水线的优势无法体现。

3.采用组合逻辑实现多周期 CPU 的有限状态机时，其输出与输入关系为：（）

   A、输出控制信号仅与当前状态有关

   B、输出控制信号与当前状态和输入 OP 有关

   C、下一状态仅与当前输入 OP 有关

   D、下一状态与当前状态和输入 OP 有关

> A。
>
> **题目问的是输出和输入的关系**，不选 CD，有限状态机的输出控制信号就是状态，只和当前状态有关，不理解的看下图：

![alt text](image-129.png)

4.以下指令，理论上跳转范围最大的为：（）

   A、J 指令

   B、JAL 指令

   C、JR 指令

   D、BEQ 指令

> C。
>
> 本题看起来需要记忆 rv32i 的指令集格式，实际上确实要记，不过不用那么麻烦。
>
> `j` 指令和 `jal` 指令一样，因为 `j imm` 就是 `jal x0, imm` 的简写。支持的跳转范围就是 imm*2 也就是 2^20 bytes
>
> `jr` 指令就是 `jalr x0, rs1, 0` 的简写。支持的跳转范围是字长的范围，也就是 2^32 bytes
>
> `beq x0, x1, imm` 里面，imm 更短只有 12 bits，因此支持的跳转范围是 2^12 bytes

5.以下属于不挥发型存储器的为：（）

   A、SDRAM

   B、SRAM

   C、DRAM

   D、FLASH

> D。
>
> SDRAM 就是一种 DRAM，原理都是电容，需要上电刷新。掉电数据丢失。
>
> SRAM 依靠触发器高电平锁存数据，需要上电。
>
> FLASH 也就是闪存，依靠的是门阵列的动态烧录，掉电数据不丢失。

6.在读某个虚拟地址单元时，发生 TLB 缺失、页表命中、Cache 命中，则访问该单元全过程共需访问主存次数为：（）

   A、1

   B、2

   C、3

   D、4

> A。
>
> 见下图即可。

![alt text](image-130.png)

7.关于流水线冒险检测的说法，正确的为：（）

   A、冒险检测机制可以避免阻塞

   B、冒险检测机制主要通过旁路以减少流水线气泡

   C、冒险检测机制主要是检测分支冒险

   D、冒险检测机制可以通过阻塞或清除手段避免指令序列出错

> D。
>
> A 项，对 Load-Use 冒险而言，检测机制不能避免阻塞。
>
> B 项，说的是转发机制。
>
> C 项，冒险检测主要检测数据冒险。分支冒险不需要检测。

8.磁盘上记录面 N 的磁道 M 存储数据已满时，如需继续存放，以下哪种方式比较合理：（）

   A、存放到记录面 N 的 M+1 磁道

   B、存放到记录面 N 的随机磁道

   C、存放到记录面 N+1 的 M 磁道

   D、存放到随机记录面的随机磁道

> C。
>
> 根据局部性原则，肯定不选 B 或者 D。由于 A 要移动磁头，而 C 无需移动磁头，时间更短。

9.计算机将外设端口与存储器进行统一编址时会导致：（）

   A、需设置单独指令访问外设端口空间

   B、存储器地址空间减少

   C、外设端口可以直接访问存储单元

   D、访问外设端口速度更快

> B。
>
> A 项，说的是独立编址。
>
> B 项，由于统一编址会占用编址空间，留给存储器的地址空间自然变小了。
>
> C 项，说的是 DMA。
>
> D 项，由于统一编址要过一遍片选，可能会更慢。

10.在某指令 K 执行时检测到外部中断事件后，以下正确的说法为：（）

    A、执行完该指令后进入中断处理

    B、外部中断事件是不可屏蔽的

    C、外部中断处理是不可嵌套的

    D、外部中断处理完后返回指令 K 继续执行

> A。
>
> B 项，不可屏蔽的外部中断很少，比如电源问题等。其他设备发出的外部中断，加入一个逻辑门就可以屏蔽。
>
> C 项，显然可以。
>
> D 项，正确的说法是 A 项。

### 二、计算题（共 4 小题，20 分）

1.（共 6 分）某程序 P 在机器 A 上编译执行，花费总时间为 15 秒。现对 A 进行改造如下：时钟频率增加 25%，同时更换编译器使得执行程序的指令总数减少 25%，平均 CPI 增加 20%，功耗增加 10%。请问：

   （1）程序 P 在改造后的机器 A 上执行时间为多少秒？

   （2）改造后较之改造前机器性能加速比为多少？

> （1）考虑有 $x$ 条指令需要 $c$ 个周期完成，CPI = $c/x$，那么改造后需要的时间周期数为 $0.75x\times 1.2c/x=0.9c$，而时间计算得到 $0.9c \times 15 / c \times 1/1.25=10.8$s.

> （2）加速比=原始执行时间 / 改进后执行时间 = $15/10.8 = 138.9\%$

2.（共 7 分）若有如下 3 个 IEEE 单精度数，分别为：X=0x00400000，Y=0x00400000，Z=0x80C00000，请分别计算：

   （1）(X+Y) + Z

   （2）X + (Y+Z)

> IEEE float32 = S1 E8 M23 我们拆开：
>
> x = y = 0 | 000 0000 0 | 100 0000 0000 0000 0000 0000 = **0**.5 * 2^-126 = 1 * 2^-127 是非规格化数
>
> z = 1 | 000 0000 1 | 100 0000 0000 0000 0000 0000 = -1.5 * 2^-126
>
> (1) 先计算 X+Y = 1 * 2^-126，再加上 Z 得到 -0.5 * 2^-126 结果为 -X 也就是 0x80400000
>
> (2) 没有大数吃小数也没有舍入误差，因此结果不变。
>
> 代码验证如下：

![alt text](image-131.png)

3.（共 7 分）假定 CPU 时钟频率为 2GHz，配备了 2 级缓存，其中 L1Cache 的命中访问时间为 1 时钟周期，命中率 90%，L2Cache 的命中访问时间为 10 时钟周期，命中率 80%，主存访问时间 300 时钟周期。请问：

   （1）该缓存系统的总体命中率是多少？

> 90% 的指令在 L1 级命中，剩下的 10% 里面，80% 在 L2 级命中。总的命中率是 98%。

   （2）单次访存缓存系统的平均时间是多少（以纳秒为单位）？

> 90% * 1 + 8% * 10 + 2% * 300 = 7.7 Cycs，由于周期 2 GHz 也就是一个周期 0.5 ns，所以期望时间为 3.85ns

   （3）采用二级缓存与仅采用一级缓存的加速比是多少？

> 仅采用一级缓存，需要 90% * 1 + 10% * 300 = 30.9 Cycs，加速比为 30.9 / 7.7 = 4.0

### 三、分析解答题（共 4 小题，50 分）

1.（共 10 分）在指令存储器如下地址处有以下指令，假定 $12 初值为 0xAABBCCDD，请填空：

   （1）20000H：BNE $8, $8, 2000H，则该指令执行完后，后续指令的地址为：（）

> $8 = $8，所以 bne 不跳转， pc = pc+4。后续为 20004H

   （2）20004H：BEQ $7, $7, 1000H，则该指令执行完后，后续指令的地址为：（）

> beq 要跳转，pc = pc + 4 + imm << 1 = 20008H + 4000H = 24008H

   （3）30008H：J 10000H，则该指令的跳转目标地址为：（）

> j 无条件跳转，pc = (pc + 4)[31:28] + imm << 1 = 10000H

   （4）40008H：ADDI $9, $0, 5000H，则该指令执行完后，寄存器$9 值为：（）

> $9 = $0 + imm = 0 + 5000H = 5000H

   （5）

   50008H：SW $12, 4($13)

   5000CH：LB $12, 4($13)，则该指令执行完后，寄存器 $12 值为：（）

> lb = Load Byte，加载字节，从地址上看，其实就是 $12 的低位字节，即 0xFFFFFFFFDD

   50010H：ADDI $12, $12, 0x56，则该指令执行完后，寄存器$12 值为：（）

> 0xDD+0x56 = 0x33 (模256)，因此结果是 0x00000033

（6）60008H：SLL $9, $8, 4，该指令格式属于（）型指令，其机器码对应 rs、rt、rd 字段分别为：（）、（）、（）。

> SLL = Shift Left Logical 是 R 型指令。rd = 9, rt = 8, rs = 0（没有使用）

### 2、（共 10 分）

假设下列 MIPS 代码在一个 5 级流水的处理器上运行，该流水线有冒险检测、有到 ID 与 EX 级的完全旁路。假设在 ID 级执行分支，采用延迟槽而且在延迟槽中的指令是分支指令的后续相邻指令，解答以下问题。

```
LW    R2, 4(R1)           # I1
LAB1: 
BEQ   R0, R2, LAB2        # I2, 第一次不发生跳转，然后发生跳转
ADD   R2, R4, R1          # I3
BEQ   R3, R2, LAB1        # I4, 发生跳转
LW    R1, 8(R3)           # I5
LAB2: 
SW    R1, 12(R2)          # I6
ADDI  R1, R2, 4           # I7
```

（1）画出该指令序列的流水线执行图；

```text
   1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16
I1 IF ID EX M  WB
I2    IF ID ID ID EX M  WB                           # 由于没有 M 阶段的旁路，需要等到 WB 段后才能 EX
I3       IF IF IF ID EX M  WB
I4                IF ID ID EX M  WB                   # ID 阶段等待 R2 结果转发
I5                   IF IF ID EX M  WB
I2                         IF ID EX M  WB
I3                            IF ID EX M  WB          # 由于 ID 段已经可以执行分支，直接冲刷 I3
I6                               IF ID EX M  WB
I7                                  IF ID EX M  WB
```

（2）指出执行过程中哪些位置用到何种旁路；

> EX/M 到 ID 级和 EX/M 到 EX 级的转发。

（3）总的执行时间是多少周期。

> 如上图，16 周期。

### 3、（共 18 分）

对于一个 4 路组相联映射的 Cache，采用下面的 32 位主存地址格式来访问 Cache。

| Block Tag | Set Index | Byte Offset inside Block |
| --------- | --------- | ------------------------ |
| 31-11     | 10-5      | 4-0                      |

（1）该 Cache 共有多少数据块，可划分为多少组，所有数据块的总容量是多大？（单位:Byte）

> 每个 block 有 2^5 = 32 bytes，一共 2^6 = 64 组，每一组 4 块。一共就是 256 块。容量是 256 * 32 = 8192 Bytes

（2）为方便 Cache 访问，请为该 Cache 设计合理的标签（tag）、有效位（vf）、理想替换位（rf）、脏位（df）等附加信息域，形成一个完整的 Cache 结构，并计算该完整 Cache 的总体容量（单位：bit）；

> vf 用来冷启动 cache，df 用来写回主存，这俩标志位只需要 1 个 bit；rf 需要覆盖到每一组的所有路，也就需要 2 bits。那么每一个 block 就需要 21(tag) + 1(vf) + 1(df) + 2(rf) = 25 位的附加信息，以及 32*8 = 256 bits 的数据，一共的容量就是 256 * (256 + 25) = 71936 bits

（3）从上电开始给出如下 10 个字节地址：0、2049、30、200、300、6144、4095、4096、208、8193，试分析该地址序列的访问过程，并按照 LRU 算法，说明有哪些 Cache 块被替换？总的块命中率是多少？

```text
0:    tag = 0, set = 0  0        miss
2049: tag = 1, set = 0  1,0      miss
30:   tag = 0, set = 0  0,1      hit
200:  tag = 0, set = 6  0,1      miss
300:  tag = 0, set = 9  0,1      miss
6144: tag = 3, set = 0  3,0,1    miss
4095: tag = 1, set = 63 3,0,1    miss
4096: tag = 2, set = 0  2,3,0,1  miss
208:  tag = 0, set = 6  2,3,0,1  hit
8193: tag = 4, set = 0  4,2,3,0  miss, 替换 tag = 1
```

> 替换 Set = 0, tag = 1 的块，命中率 20%

### 4、（共 12 分）

考虑一个采用 5 位校验位来保护 8 位数据信息的汉明码 SEC/DED，并假设编码的位编号是从 MSB（Most Significant Bit）向 LSB（Least Significant Bit）方向增大。如果接收方接收到的值为 0x1E54，请判断该编码是否有错，并说明判断依据？如果有错，请指出错误位置并纠正，还原为正确的汉明码并提取 8 位原始数据信息。

``` 
0x1E54 = 0001 1110 0101 0100
码字排列： P5 M8 M7 M6 M5 P4 M4 M3 M2 P3 M1 P2 P1
映射一下： 0  0  1  0  1  0  1  0  0  1  1  1  1
P' = 00111, M = 0101 1001(MSB->LSB)
P'' = 00110 => S = 00001 即 P1 出错，正确的汉明码是 0x0E54，数据是 0x59
```