
<!DOCTYPE html>

<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../misc/" rel="prev"/>
<link href="../Adaptive/" rel="next"/>
<link href="../../../favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>ç¬¦å·æ¢¯åº¦ä¸‹é™ - Dicaeopolis' Wiki</title>
<link href="../../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../themes/css/custom.css" rel="stylesheet"/>
<link href="../../../themes/css/simpleLightbox.min.css" rel="stylesheet"/>
<link href="../../../themes/css/pied_piper.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet"/>
<link href="../../../stylesheets/customize.css" rel="stylesheet"/>
<link href="../../../assets/css/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          è·³è½¬è‡³
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="é¡µçœ‰" class="md-header__inner md-grid">
<a aria-label="Dicaeopolis' Wiki" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Dicaeopolis' Wiki">
<img alt="logo" src="../../../favicon.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Dicaeopolis' Wiki
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              ç¬¦å·æ¢¯åº¦ä¸‹é™
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="æœç´¢" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="æœç´¢" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="æŸ¥æ‰¾" class="md-search__options">
<button aria-label="æ¸…ç©ºå½“å‰å†…å®¹" class="md-search__icon md-icon" tabindex="-1" title="æ¸…ç©ºå½“å‰å†…å®¹" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="æ ‡ç­¾" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../astronomy/">
          
  
  
    
  
  å¤©æ–‡æ‘„å½±ç†è®ºå’Œå®è·µ

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../campus-sources/">
          
  
  
    
  
  æ ¡å†…è¯¾ç¨‹çŸ¥è¯†

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
  
    
  
  æ·±åº¦ç¥ç»ç½‘ç»œ

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../misc/">
          
  
  
    
  
  é…ç½®å’Œæ‚è°ˆç¬”è®°

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../algorithm/">
          
  
  
    
  
  ä¼ ç»Ÿç®—æ³•ä¸æ€§èƒ½

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="å¯¼èˆªæ " class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Dicaeopolis' Wiki" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Dicaeopolis' Wiki">
<img alt="logo" src="../../../favicon.png"/>
</a>
    Dicaeopolis' Wiki
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../astronomy/">
<span class="md-ellipsis">
    
  
    å¤©æ–‡æ‘„å½±ç†è®ºå’Œå®è·µ
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    å¤©æ–‡æ‘„å½±ç†è®ºå’Œå®è·µ
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../astronomy/gallery/">
<span class="md-ellipsis">
    
  
    æ·±ç©ºå½±é›†
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../astronomy/polar/">
<span class="md-ellipsis">
    
  
    çœ‹ä¸è§åŒ—ææ˜Ÿæ€ä¹ˆåŠ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../astronomy/%E6%96%B9%E4%BD%8D%E8%B0%83%E8%8A%82/">
<span class="md-ellipsis">
    
  
    æ–¹ä½è°ƒèŠ‚
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../astronomy/%E7%BA%AC%E5%BA%A6%E8%B0%83%E8%8A%82/">
<span class="md-ellipsis">
    
  
    çº¬åº¦è°ƒèŠ‚
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../campus-sources/">
<span class="md-ellipsis">
    
  
    æ ¡å†…è¯¾ç¨‹çŸ¥è¯†
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            
  
    æ ¡å†…è¯¾ç¨‹çŸ¥è¯†
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/SDC-exams/">
<span class="md-ellipsis">
    
  
    ã€Šè®¡ç®—æœºç»„æˆä¸è®¾è®¡ã€‹éƒ¨åˆ†å†å¹´é¢˜ç›®é¢˜è§£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/Discrete_exams/">
<span class="md-ellipsis">
    
  
    ã€Šç¦»æ•£æ•°å­¦ã€‹éƒ¨åˆ†æœŸæœ«é¢˜ç›®é¢˜è§£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/Discrete_notes/">
<span class="md-ellipsis">
    
  
    ç¦»æ•£æœŸæœ«å¤ä¹ æçº²
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/Descrete_assignments/">
<span class="md-ellipsis">
    
  
    ã€Šç¦»æ•£æ•°å­¦ã€‹è¯¾ç¨‹ä½œä¸šä¸ç¬”è®°å½’æ¡£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/Prob_Stats_assignments/">
<span class="md-ellipsis">
    
  
    ã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹è¯¾ç¨‹ä½œä¸šä¸ç¬”è®°å½’æ¡£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/SDC_assignments/">
<span class="md-ellipsis">
    
  
    ã€Šè®¡ç®—æœºç»„æˆåŸç†ã€‹ç†è®ºè¯¾ç¨‹ä½œä¸šä¸ç¬”è®°å½’æ¡£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/PU_Bii_assignments/">
<span class="md-ellipsis">
    
  
    ã€Šå¤§å­¦ç‰©ç†Bä¸‹ã€‹è¯¾ç¨‹ä½œä¸šä¸ç¬”è®°å½’æ¡£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/binmul/">
<span class="md-ellipsis">
<i class="fas fa-calculator"></i> äºŒè¿›åˆ¶ä¹˜æ³•å¯è§†åŒ–å·¥å…·
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/textbook/">
<span class="md-ellipsis">
    
  
    æœ¬ç§‘æ•™ç§‘ä¹¦ç”µå­èµ„æº
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/ds-keynote/">
<span class="md-ellipsis">
    
  
    ã€Šæ•°æ®ç»“æ„ã€‹åˆ’é‡ç‚¹ç¬”è®°
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/ds-write-up/">
<span class="md-ellipsis">
    
  
    ã€Šæ•°æ®ç»“æ„ã€‹æœŸæœ«å¤ä¹ é¢˜é¢˜è§£
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../campus-sources/autosignin/">
<span class="md-ellipsis">
    
  
    è‡ªåŠ¨ç­¾åˆ°è„šæœ¬
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    
  
    æ·±åº¦ç¥ç»ç½‘ç»œ
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    æ·±åº¦ç¥ç»ç½‘ç»œ
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../match/">
<span class="md-ellipsis">
    
  
    å¦‚ä½•åšå››å…­çº§è€ƒè¯•çš„æ®µè½åŒ¹é…é¢˜
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../BP/">
<span class="md-ellipsis">
    
  
    å‰é¦ˆç¥ç»ç½‘ç»œçš„åå‘ä¼ æ’­
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../RL/">
<span class="md-ellipsis">
    
  
    RLå­¦ä¹ ç¬”è®° - ä¸Šç¯‡
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../SVM_SMO/">
<span class="md-ellipsis">
    
  
    SMO ç®—æ³•çš„æ¨å¯¼
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Wp
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Wp
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../WP/aiwp/">
<span class="md-ellipsis">
    
  
    MISC-AI æ–¹å‘ WriteUp
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../model-attack/">
<span class="md-ellipsis">
    
  
    æ·±åº¦å­¦ä¹ æ¨¡å‹æ”»å‡»ç†è®ºä¸å¤ç°å½’æ¡£
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_7">
<span class="md-nav__icon md-icon"></span>
            
  
    æ·±åº¦å­¦ä¹ æ¨¡å‹æ”»å‡»ç†è®ºä¸å¤ç°å½’æ¡£
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-attack/hsja/">
<span class="md-ellipsis">
    
  
    HSJA æ”»å‡»
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-attack/BadNets/">
<span class="md-ellipsis">
    
  
    BadNets
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-attack/CandW/">
<span class="md-ellipsis">
    
  
    C&amp;W æ”»å‡»
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-attack/pgd/">
<span class="md-ellipsis">
    
  
    PGD æ”»å‡»
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-attack/fgsm/">
<span class="md-ellipsis">
    
  
    FGSM æ”»å‡»
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../model-expr/">
<span class="md-ellipsis">
    
  
    æ·±åº¦å­¦ä¹ ç›¸å…³æ¨¡å‹ç†è®ºä¸å¤ç°å½’æ¡£
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_8">
<span class="md-nav__icon md-icon"></span>
            
  
    æ·±åº¦å­¦ä¹ ç›¸å…³æ¨¡å‹ç†è®ºä¸å¤ç°å½’æ¡£
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-expr/DDPM/">
<span class="md-ellipsis">
    
  
    æ‰©æ•£æ¨¡å‹ç†è®ºç¯‡: ä»å¤šé˜¶æ®µå˜åˆ†è‡ªç¼–ç å™¨åˆ°æ¦‚ç‡æµå¸¸å¾®åˆ†æ–¹ç¨‹é‡‡æ ·å™¨ç³»åˆ—
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-expr/S-and-D-models-replication/">
<span class="md-ellipsis">
    
  
    å›¾åƒè¯­ä¹‰åˆ†å‰²å’Œç›®æ ‡æ£€æµ‹ç›¸å…³æ¨¡å‹å¤ç°æ‰‹è®°
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-expr/Image-models-replication/">
<span class="md-ellipsis">
    
  
    å›¾åƒåˆ†ç±»ç›¸å…³æ¨¡å‹å¤ç°æ‰‹è®°
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model-expr/DC-GAN-%E8%80%81%E5%A9%86%E7%94%9F%E6%88%90%E5%99%A8/">
<span class="md-ellipsis">
    
  
    DC-GAN è€å©†ç”Ÿæˆå™¨
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    
  
    ä¼˜åŒ–å™¨
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_3_9_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_9">
<span class="md-nav__icon md-icon"></span>
            
  
    ä¼˜åŒ–å™¨
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../misc/">
<span class="md-ellipsis">
    
  
    åç»­çš„å†™ä½œè®¡åˆ’
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    ç¬¦å·æ¢¯åº¦ä¸‹é™
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    ç¬¦å·æ¢¯åº¦ä¸‹é™
  

    
  </span>
</a>
<nav aria-label="ç›®å½•" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#rprop">
<span class="md-ellipsis">
      
        Rprop
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lion">
<span class="md-ellipsis">
      
        Lion
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#muon">
<span class="md-ellipsis">
      
        Muon
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Adaptive/">
<span class="md-ellipsis">
    
  
    è‡ªé€‚åº”å­¦ä¹ ç‡æ”¹è¿›ç­–ç•¥
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SGD/">
<span class="md-ellipsis">
    
  
    SGD ç³»åˆ—ç®—æ³•
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../misc/">
<span class="md-ellipsis">
    
  
    é…ç½®å’Œæ‚è°ˆç¬”è®°
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    é…ç½®å’Œæ‚è°ˆç¬”è®°
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../misc/test/">
<span class="md-ellipsis">
    
  
    åŠŸèƒ½æµ‹è¯•é¡µé¢
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../algorithm/">
<span class="md-ellipsis">
    
  
    ä¼ ç»Ÿç®—æ³•ä¸æ€§èƒ½
  

    
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    ä¼ ç»Ÿç®—æ³•ä¸æ€§èƒ½
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../algorithm/benchmark-on-stl/">
<span class="md-ellipsis">
    
  
    STLçš„ä¸€äº›æ€§èƒ½æµ‹è¯•
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../algorithm/stl-wheels/">
<span class="md-ellipsis">
    
  
    å—¯é€ è½®å­
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../algorithm/template-on-numeric-ring/">
<span class="md-ellipsis">
    
  
    æ•´æ•°ç¯å–æ¨¡æ¨¡æ¿
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="ç›®å½•" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#rprop">
<span class="md-ellipsis">
      
        Rprop
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lion">
<span class="md-ellipsis">
      
        Lion
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#muon">
<span class="md-ellipsis">
      
        Muon
      
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="_1">ç¬¦å·æ¢¯åº¦ä¸‹é™<a class="headerlink" href="#_1" title="Permanent link">Â¶</a></h1>
<div class="admonition info">
<p class="admonition-title">ğŸ“– é˜…è¯»ä¿¡æ¯</p>
<p>é˜…è¯»æ—¶é—´çº¦ <strong>19</strong> åˆ†é’Ÿã€€|ã€€çº¦ <strong>2029</strong> å­—ã€€|ã€€çº¦ <strong>57</strong> ä¸ªå…¬å¼ã€€|ã€€çº¦ <strong>470</strong> è¡Œä»£ç </p>
</div>
<p>å¦‚æœæ˜¯è¿‘ä¼¼ Hessian çŸ©é˜µæ˜¯ä¼˜åŒ–å™¨ç†è®ºå‘å±•çš„ä¸€æ¡â€œæ˜çº¿â€ï¼Œé‚£ä¹ˆå¯¹æ¢¯åº¦å–â€œç¬¦å·â€æ¥è®¡ç®—ï¼Œåˆ™æ˜¯å¯¹åº”çš„ä¸€æ¡â€œæš—çº¿â€ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°åˆšåˆšè®¨è®ºçš„é‚£äº›ä¼˜åŒ–å™¨æ˜¯å¦‚ä½•åœ¨è¿™æ¡â€œæš—çº¿â€ä¸‹èµ°å‘ç»Ÿä¸€çš„ã€‚åŒæ—¶ï¼Œè¿™æ¡â€œæš—çº¿â€ä¹Ÿæ¸æ¸è¶ŠæŒ‘è¶Šæ˜ï¼Œé€æ¸æˆä¸ºå¤§è§„æ¨¡ç¥ç»ç½‘ç»œè®­ç»ƒä¼˜åŒ–çš„æ–°çš„ç†è®ºæŒ‡å¯¼ã€‚</p>
<h2 id="rprop">Rprop<a class="headerlink" href="#rprop" title="Permanent link">Â¶</a></h2>
<p>Rprop çš„å‡ºç°æ—©äº RMSpropï¼Œä»å‘½åé£æ ¼å°±å¯ä»¥çœ‹å‡ºå®ƒä»¬çš„ä¸€è„‰ç›¸æ‰¿ã€‚</p>
<p>å›å¿†ä¸€ä¸‹ RMSprop çš„è®¡ç®—ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¢¯åº¦ç¼©æ”¾ç³»æ•° <span class="arithmatex">\(\sqrt{G_n}\)</span>ï¼Œå…¶ä¸­ <span class="arithmatex">\(G\)</span> æ˜¯å¯¹ <span class="arithmatex">\(g^2\)</span> çš„å¹³å‡ã€‚</p>
<p>é‚£ä¹ˆæœ€åçš„å‚æ•°æ›´æ–°å°±å˜æˆäº† <span class="arithmatex">\(-\eta\dfrac{g}{\sqrt{\bar g^2}}\)</span>ï¼Œå¦‚æœæˆ‘ä»¬è€ƒè™‘å…¨é‡ï¼ˆFull batchï¼‰æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯è®© <span class="arithmatex">\(\mathcal{|B|}=n\)</span> å³ Batch size ç­‰äºæ ·æœ¬æ•°é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”šè‡³å¯ä»¥æŠŠè¿™ä¸ªâ€œå¹³å‡æ¢¯åº¦â€çš„å¹³å‡å»æ‰ã€‚è¿™æ ·å®é™…çš„æ›´æ–°é‡å°±æ˜¯æ¢¯åº¦çš„<strong>ç¬¦å·å‡½æ•°</strong> <span class="arithmatex">\(\mathrm{sign}(g)\)</span> äº†ï¼</p>
<p>è¿™å°±æ˜¯ Rprop çš„æ›´æ–°åŸç†ã€‚ä¹Ÿå°±æ˜¯æ‰€æœ‰ç¬¦å·æ¢¯åº¦ä¸‹é™ä¼˜åŒ–å™¨çš„ç†è®ºæ ¸å¿ƒï¼šæ¢¯åº¦çš„<strong>æ–¹å‘</strong>ç›¸æ¯”å…¶åœ¨ä¸åŒæ–¹å‘çš„<strong>å¤§å°</strong>æ›´é‡è¦ï¼</p>
<p>å›åˆ°æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„é‚£ä¸ªæ¤­åœ†æŠ›ç‰©é¢ï¼Œå¦‚æœæˆ‘ä»¬è¿‡äºä¾èµ–æ¢¯åº¦å¤§å°ï¼Œå°±ä¼šé€ æˆâ€œåå¤æ¨ªè·³â€çš„é—®é¢˜ï¼Œå› ä¸ºæ¢¯åº¦åœ¨æˆ‘ä»¬é¢„æœŸçš„ä¼˜åŒ–æ–¹å‘çš„<strong>å‚ç›´</strong>æ–¹å‘ä¸Šï¼Œæœ‰ç›¸å½“å¤§çš„å¤§å°ï¼Œè¿™å°±å½±å“äº†ä¼˜åŒ–å™¨åœ¨ Hessian çŸ©é˜µæ¡ä»¶æ•°ç›¸å½“å¤§çš„æ—¶å€™ï¼Œé€ƒç¦»éç‚¹çš„èƒ½åŠ›ã€‚</p>
<p>åœ¨çœ‹å…¬å¼ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ Rprop çš„æ•ˆæœå§ï¼š</p>
<p><img alt="rastrigin_Rprop" src="../optimizer_pics/rastrigin_Rprop.gif"/></p>
<p><img alt="rosenbrock_Rprop" src="../optimizer_pics/rosenbrock_Rprop.gif"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¿½ç•¥å…¨é‡æ¢¯åº¦è®¡ç®—è¿™ä¸ªï¼ˆå¤§ï¼‰é—®é¢˜ï¼ŒRprop åœ¨è¿™ä¸¤ä¸ªåœ°å½¢çš„æ”¶æ•›èƒ½åŠ›å®Œå…¨å¯ä»¥åª²ç¾ Adamï¼å°¤å…¶æ˜¯åœ¨ rosenbrock åœ°å½¢ä¸‹ Rprop æ²¿ç€è°·åº•ç§»åŠ¨çš„é€Ÿåº¦æ˜¯ç›¸å½“å¿«çš„ã€‚</p>
<p>ä¸‹é¢åˆ™å±•ç¤ºäº†å¦‚æœä»¥ mini-batch æ–¹å¼è¿è¡Œ Rprop çš„æƒ¨çƒˆæ•ˆæœï¼š</p>
<p><img alt="Rprop_performance_curves" src="../optimizer_pics/Rprop_performance_curves.png"/></p>
<p><img alt="Rprop_landscape_pca" src="../optimizer_pics/Rprop_landscape_pca.png"/></p>
<p>æ¼”éƒ½ä¸æ¼”äº†ï¼Œæ ¹æœ¬æ”¶æ•›ä¸äº†ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Rprop çš„æ›´æ–°å…¬å¼ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    g_n&amp;=\nabla\mathcal{L({x_{\mathrm{full}}};\theta_{n-1})}\\
    \hat g_n&amp;=\mathrm{sign}(g_n)\\
    \theta_n&amp;=\theta_{n-1}-\eta\hat g_n
\end{align*}
\]</div>
<p>ç”±æ­¤ï¼Œå°±èƒ½å†™å‡ºä»£ç äº†ï¼š</p>
<details>
<summary> Rprop çš„å®ç°</summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_single_tensor_rprop</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">grads</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="n">prevs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="n">step_sizes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">state_steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">step_size_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="n">step_size_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="n">etaminus</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="n">etaplus</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="n">maximize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="n">capturable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">differentiable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">has_complex</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="c1"># å¾ªç¯å¤„ç†æ¯ä¸ªå‚æ•°</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="n">grad</span> <span class="o">=</span> <span class="n">grads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="n">grad</span> <span class="o">=</span> <span class="n">grad</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">maximize</span> <span class="k">else</span> <span class="o">-</span><span class="n">grad</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">prev</span> <span class="o">=</span> <span class="n">prevs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">step_size</span> <span class="o">=</span> <span class="n">step_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="n">step</span> <span class="o">=</span> <span class="n">state_steps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="c1"># --- CUDA Graph æ•è·æ£€æŸ¥ ---</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">compiler</span><span class="o">.</span><span class="n">is_compiling</span><span class="p">()</span> <span class="ow">and</span> <span class="n">capturable</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>            <span class="n">capturable_supported_devices</span> <span class="o">=</span> <span class="n">_get_capturable_supported_devices</span><span class="p">()</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>                <span class="n">param</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">step</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>                <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">capturable_supported_devices</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="p">),</span> <span class="s2">"å¦‚æœ capturable=True, params å’Œ state_steps å¿…é¡»åœ¨æ”¯æŒçš„è®¾å¤‡ä¸Šã€‚"</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="c1"># --- å¤„ç†å¤æ•° ---</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_complex</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>            <span class="n">grad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">view_as_real</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="n">prev</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">view_as_real</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">view_as_real</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">view_as_real</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="c1"># --- Rprop æ ¸å¿ƒé€»è¾‘ ---</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="c1"># 1. è®¡ç®—å½“å‰æ¢¯åº¦ä¸ä¸Šä¸€æ­¥æ¢¯åº¦çš„ä¹˜ç§¯çš„ç¬¦å·</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="c1"># sign &gt; 0: æ¢¯åº¦ç¬¦å·ç›¸åŒ</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="c1"># sign &lt; 0: æ¢¯åº¦ç¬¦å·ç›¸å</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="c1"># sign = 0: å…¶ä¸­ä¸€ä¸ªæ¢¯åº¦ä¸ºé›¶</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="k">if</span> <span class="n">differentiable</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="c1"># åœ¨å¯å¾®åˆ†æ¨¡å¼ä¸‹ï¼Œéœ€è¦å…‹éš† prev ä»¥é˜²åŸåœ°æ“ä½œç ´åè®¡ç®—å›¾</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="n">sign</span> <span class="o">=</span> <span class="n">grad</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">sign</span> <span class="o">=</span> <span class="n">grad</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="c1"># 2. æ ¹æ®ç¬¦å· sign çš„å€¼ï¼Œç¡®å®šæ­¥é•¿çš„æ›´æ–°å› å­</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="c1"># è¿™é‡Œç”¨ sign å¼ é‡æ¥å­˜å‚¨æ›´æ–°å› å­ (etaplus, etaminus, 1)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="k">if</span> <span class="n">capturable</span><span class="p">:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="c1"># Capturable æ¨¡å¼ä¸‹ä½¿ç”¨ torch.where</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">sign</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sign</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">etaplus</span><span class="p">,</span> <span class="n">sign</span><span class="p">))</span>   <span class="c1"># ç¬¦å·ç›¸åŒï¼Œæ›´æ–°å› å­ä¸º etaplus</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="n">sign</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sign</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">etaminus</span><span class="p">,</span> <span class="n">sign</span><span class="p">))</span>  <span class="c1"># ç¬¦å·ç›¸åï¼Œæ›´æ–°å› å­ä¸º etaminus</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">sign</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sign</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sign</span><span class="p">))</span>         <span class="c1"># ç¬¦å·ä¸º0ï¼Œæ›´æ–°å› å­ä¸º 1 (æ­¥é•¿ä¸å˜)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="c1"># å¸¸è§„æ¨¡å¼ä¸‹ä½¿ç”¨ç´¢å¼•èµ‹å€¼ï¼Œé€šå¸¸æ›´é«˜æ•ˆ</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">sign</span><span class="p">[</span><span class="n">sign</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">etaplus</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">sign</span><span class="p">[</span><span class="n">sign</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">etaminus</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="n">sign</span><span class="p">[</span><span class="n">sign</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="c1"># 3. æ›´æ–°æ­¥é•¿</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="c1"># ç”¨æ›´æ–°å› å­ä¹˜ä»¥å½“å‰æ­¥é•¿ï¼Œå¹¶å°†å…¶é™åˆ¶åœ¨ [step_size_min, step_size_max] èŒƒå›´å†…</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">step_size</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="n">step_size_min</span><span class="p">,</span> <span class="n">step_size_max</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="c1"># 4. æ ¹æ® Rprop è§„åˆ™ä¿®æ”¹å½“å‰æ¢¯åº¦</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="c1"># è¿™æ˜¯ä¸€ä¸ª Rprop çš„å˜ä½“è§„åˆ™ï¼šå¦‚æœæ¢¯åº¦ç¬¦å·åè½¬ (sign.eq(etaminus))ï¼Œ</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="c1"># åˆ™æœ¬æ¬¡æ›´æ–°çš„æ¢¯åº¦è®¾ä¸º0ï¼Œæ„å‘³ç€å‚æ•°åœ¨è¿™ä¸€æ­¥ä¸ç§»åŠ¨ã€‚</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">grad</span> <span class="o">=</span> <span class="n">grad</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">memory_format</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">preserve_format</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">if</span> <span class="n">capturable</span><span class="p">:</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">grad</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sign</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">etaminus</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">grad</span><span class="p">))</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="n">grad</span><span class="p">[</span><span class="n">sign</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">etaminus</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="c1"># 5. æ›´æ–°å‚æ•°</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="c1"># å‚æ•°çš„æ›´æ–°é‡åªå–å†³äºå½“å‰æ¢¯åº¦çš„ç¬¦å·å’Œæ›´æ–°åçš„æ­¥é•¿</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="c1"># å…¬å¼: param_t = param_{t-1} - sign(grad_t) * step_size_t</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">param</span><span class="o">.</span><span class="n">addcmul_</span><span class="p">(</span><span class="n">grad</span><span class="o">.</span><span class="n">sign</span><span class="p">(),</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="c1"># 6. ä¿å­˜å½“å‰æ¢¯åº¦ï¼Œä½œä¸ºä¸‹ä¸€æ­¥çš„ "prev"</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">prev</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<p>ä»£ç ç›¸å¯¹åˆšåˆšçš„è®²è§£å¤šäº†äº¿ç‚¹ç‚¹ç»†èŠ‚ï¼Œå› ä¸ºå®ƒå®ç°çš„æ˜¯åå« Rprop with weight-backtracking çš„ç®—æ³•ã€‚è¿™ä¸ªæ”¹è¿›çš„ä½œç”¨ä½“ç°åœ¨æˆ‘ä»¬ä¹‹å‰æè¿‡æ— æ•°æ¬¡çš„æ¤­åœ†æŠ›ç‰©é¢ä¸Šé¢ï¼ŒåŠ å…¥ <code>sign</code> é¡¹ä¹‹åï¼Œå°±å¯ä»¥æ£€æµ‹åˆ°æ¢¯åº¦åœ¨â€œåå¤æ¨ªè·³â€ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸åº”è¯¥æ”¾ä»»å®ƒè·³ï¼Œè€Œæ˜¯å‡å°‘æ­¥é•¿æ‰æ›´æœ‰å¸Œæœ›è½åˆ°ä¸‹é¢ã€‚</p>
<h2 id="lion">Lion<a class="headerlink" href="#lion" title="Permanent link">Â¶</a></h2>
<p>Lion ä¼˜åŒ–å™¨æ˜¯ Google å›¢é˜Ÿæœå‡ºæ¥çš„ä¼˜åŒ–å™¨ï¼Œå°½ç®¡ä¸æ˜¯ä»æŸä¸ªç†è®ºæ¨å¯¼ä¸‹æ¥ï¼ŒLion ä¼˜åŒ–å™¨ä»ç„¶åœ¨åŒç­‰å‚æ•°é‡ä¸‹å–å¾—äº†è‡³å°‘å’Œ AdamW æ‰“å¹³çš„æ€§èƒ½ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼ŒLion ä¼˜åŒ–å™¨çš„å‚æ•°æ›´æ–°è§„åˆ™æ˜¯ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    g_n&amp;=\nabla\mathcal{L(x;\theta_{n-1})}\\
    G_n&amp;=\mathrm{sign}(\beta_1 M_{n-1}+(1-\beta_1)g_n)\\
    \theta_n&amp;=\theta_{n-1}+\eta(G_n+\lambda \theta_{n-1})\\
    M_n &amp;= \beta_2 M_{n-1}+(1-\beta_2)g_n
\end{align*}
\]</div>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒLion ç±»ä¼¼äºå¼•å…¥åŠ¨é‡çš„ Rpropï¼Œä¸è¿‡åªæ˜¯æŠŠåŠ¨é‡çš„æ›´æ–°æ”¾åˆ°äº†æœ€åã€‚è¿™é‡Œæ²¡æœ‰ä½¿ç”¨å…¨é‡è®¡ç®—ï¼Œè€Œæ˜¯ä½¿ç”¨å¹³å‡æ¢¯åº¦æ¥è§„é¿å…¨é‡è®¡ç®—çš„å¤æ‚åº¦ã€‚ç”±äºåŠ¨é‡çš„å¼•å…¥ï¼ŒLion éœ€è¦æ›´å°çš„å­¦ä¹ ç‡ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ Lion çš„æ•ˆæœï¼š</p>
<p><img alt="rastrigin_Lion" src="../optimizer_pics/rastrigin_Lion.gif"/></p>
<p><img alt="rastrigin_Lion_2" src="../optimizer_pics/rastrigin_Lion_2.gif"/></p>
<p><img alt="rosenbrock_Lion" src="../optimizer_pics/rosenbrock_Lion.gif"/></p>
<p>å¯ä»¥çœ‹è§ Lion ä¹Ÿåœ¨è¿™ä¸¤ä¸ªåœ°å½¢è·å¾—äº†ä¸é”™çš„è¡¨ç°ã€‚è™½ç„¶åœ¨ rastrigin åœ°å½¢ä¸‹é¢ hyperopt å¹¶æ²¡æœ‰æœå‡ºä¸€ä¸ªç‰¹åˆ«å¥½çš„å‚æ•°ï¼ˆç¬¬ä¸€å¼ å›¾å¤ªå°ç¬¬äºŒå¼ å›¾å¤ªå¤§ï¼‰ï¼Œä½†æ˜¯å¯¹äº rosenbrock åœ°å½¢ï¼ŒLion å–å¾—äº†æˆ‘ä»¬ç›®å‰æ‰€è§æœ€å¿«çš„è°·åº•è¡Œè¿›é€Ÿåº¦ã€‚</p>
<p><img alt="Lion_performance_curves" src="../optimizer_pics/Lion_performance_curves.png"/></p>
<p><img alt="Lion_landscape_pca" src="../optimizer_pics/Lion_landscape_pca.png"/></p>
<p>Lion åœ¨è¿™ä¸ªä»»åŠ¡ä¸‹é¢ç›¸å½“èƒ½æ‰“å•Šã€‚ä»…éœ€è¦çº¦ 3500 ä¸ª batch å°±å¯ä»¥å°† train_loss é™åˆ° 0.1 æ°´å¹³ï¼Œçº¦ 700 ä¸ª batch å°±å¯ä»¥æŠŠ acc åˆ·ä¸Š 0.9ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ <code>torch-optimizer</code> åº“çš„å®ç°ï¼š</p>
<details>
<summary> Lion ä¼˜åŒ–å™¨çš„å®ç° </summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">  1</a></span>
<span class="normal"><a href="#__codelineno-1-2">  2</a></span>
<span class="normal"><a href="#__codelineno-1-3">  3</a></span>
<span class="normal"><a href="#__codelineno-1-4">  4</a></span>
<span class="normal"><a href="#__codelineno-1-5">  5</a></span>
<span class="normal"><a href="#__codelineno-1-6">  6</a></span>
<span class="normal"><a href="#__codelineno-1-7">  7</a></span>
<span class="normal"><a href="#__codelineno-1-8">  8</a></span>
<span class="normal"><a href="#__codelineno-1-9">  9</a></span>
<span class="normal"><a href="#__codelineno-1-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-1-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-1-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-1-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-1-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-1-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-1-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-1-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-1-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-1-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-1-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-1-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-1-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-1-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-1-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-1-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-1-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-1-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-1-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-1-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-1-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-1-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-1-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-1-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-1-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-1-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-1-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-1-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-1-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-1-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-1-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-1-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-1-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-1-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-1-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-1-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-1-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-1-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-1-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-1-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-1-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-1-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-1-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-1-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-1-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-1-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-1-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-1-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-1-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-1-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-1-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-1-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-1-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-1-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-1-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-1-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-1-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-1-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-1-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-1-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-1-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-1-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-1-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-1-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-1-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-1-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-1-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-1-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-1-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-1-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-1-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-1-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-1-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-1-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-1-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-1-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-1-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-1-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-1-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-1-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-1-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-1-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-1-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-1-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-1-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-1-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-1-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-1-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-1-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-1-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-1-100">100</a></span>
<span class="normal"><a href="#__codelineno-1-101">101</a></span>
<span class="normal"><a href="#__codelineno-1-102">102</a></span>
<span class="normal"><a href="#__codelineno-1-103">103</a></span>
<span class="normal"><a href="#__codelineno-1-104">104</a></span>
<span class="normal"><a href="#__codelineno-1-105">105</a></span>
<span class="normal"><a href="#__codelineno-1-106">106</a></span>
<span class="normal"><a href="#__codelineno-1-107">107</a></span>
<span class="normal"><a href="#__codelineno-1-108">108</a></span>
<span class="normal"><a href="#__codelineno-1-109">109</a></span>
<span class="normal"><a href="#__codelineno-1-110">110</a></span>
<span class="normal"><a href="#__codelineno-1-111">111</a></span>
<span class="normal"><a href="#__codelineno-1-112">112</a></span>
<span class="normal"><a href="#__codelineno-1-113">113</a></span>
<span class="normal"><a href="#__codelineno-1-114">114</a></span>
<span class="normal"><a href="#__codelineno-1-115">115</a></span>
<span class="normal"><a href="#__codelineno-1-116">116</a></span>
<span class="normal"><a href="#__codelineno-1-117">117</a></span>
<span class="normal"><a href="#__codelineno-1-118">118</a></span>
<span class="normal"><a href="#__codelineno-1-119">119</a></span>
<span class="normal"><a href="#__codelineno-1-120">120</a></span>
<span class="normal"><a href="#__codelineno-1-121">121</a></span>
<span class="normal"><a href="#__codelineno-1-122">122</a></span>
<span class="normal"><a href="#__codelineno-1-123">123</a></span>
<span class="normal"><a href="#__codelineno-1-124">124</a></span>
<span class="normal"><a href="#__codelineno-1-125">125</a></span>
<span class="normal"><a href="#__codelineno-1-126">126</a></span>
<span class="normal"><a href="#__codelineno-1-127">127</a></span>
<span class="normal"><a href="#__codelineno-1-128">128</a></span>
<span class="normal"><a href="#__codelineno-1-129">129</a></span>
<span class="normal"><a href="#__codelineno-1-130">130</a></span>
<span class="normal"><a href="#__codelineno-1-131">131</a></span>
<span class="normal"><a href="#__codelineno-1-132">132</a></span>
<span class="normal"><a href="#__codelineno-1-133">133</a></span>
<span class="normal"><a href="#__codelineno-1-134">134</a></span>
<span class="normal"><a href="#__codelineno-1-135">135</a></span>
<span class="normal"><a href="#__codelineno-1-136">136</a></span>
<span class="normal"><a href="#__codelineno-1-137">137</a></span>
<span class="normal"><a href="#__codelineno-1-138">138</a></span>
<span class="normal"><a href="#__codelineno-1-139">139</a></span>
<span class="normal"><a href="#__codelineno-1-140">140</a></span>
<span class="normal"><a href="#__codelineno-1-141">141</a></span>
<span class="normal"><a href="#__codelineno-1-142">142</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># å¯¼å…¥ PyTorch æ ¸å¿ƒåº“</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1"># ä» PyTorch ä¼˜åŒ–å™¨åŸºç±»ä¸­å¯¼å…¥ Optimizerï¼Œæ‰€æœ‰è‡ªå®šä¹‰ä¼˜åŒ–å™¨éƒ½åº”ç»§æ‰¿å®ƒ</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">torch.optim.optimizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optimizer</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="c1"># ä»æœ¬åœ°ç±»å‹å®šä¹‰æ–‡ä»¶ä¸­å¯¼å…¥ç±»å‹æç¤ºï¼Œå¢å¼ºä»£ç å¯è¯»æ€§</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="c1"># Betas2: ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæµ®ç‚¹æ•°çš„å…ƒç»„ï¼Œå¦‚ (0.9, 0.99)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="c1"># OptFloat: å¯é€‰çš„æµ®ç‚¹æ•°ï¼Œå³ float æˆ– None</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="c1"># OptLossClosure: å¯é€‰çš„æŸå¤±é—­åŒ…å‡½æ•°</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1"># Params: å¯è¿­ä»£çš„å‚æ•°æˆ–å®šä¹‰äº†å‚æ•°ç»„çš„å­—å…¸</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">torch_optimizer.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Betas2</span><span class="p">,</span> <span class="n">OptFloat</span><span class="p">,</span> <span class="n">OptLossClosure</span><span class="p">,</span> <span class="n">Params</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="c1"># å®šä¹‰å½“ `from module import *` æ—¶ï¼Œå“ªäº›å¯¹è±¡ä¼šè¢«å¯¼å‡º</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"Lion"</span><span class="p">,)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="c1"># å®šä¹‰ Lion ä¼˜åŒ–å™¨ç±»ï¼Œå®ƒç»§æ‰¿è‡ª PyTorch çš„ Optimizer åŸºç±»</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Lion</span><span class="p">(</span><span class="n">Optimizer</span><span class="p">):</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="sa">r</span><span class="sd">"""å®ç°äº† Lion ç®—æ³•ã€‚</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="sd">    ä»£ç æ”¹ç¼–è‡ª Google çš„å®˜æ–¹å®ç°: https://github.com/google/automl/tree/master/lion</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="sd">    Lion - EvoLved SIgn MOmeNtum (æ¼”è¿›çš„ç¬¦å·åŠ¨é‡) ç®—æ³•åœ¨</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="sd">    è®ºæ–‡ https://arxiv.org/pdf/2302.06675.pdf ä¸­è¢«æå‡ºã€‚</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="sd">    Lion çš„ç›®æ ‡æ˜¯é€šè¿‡åªè·Ÿè¸ªåŠ¨é‡æ¥æ¯” Adam ç®—æ³•æ›´èŠ‚çœå†…å­˜ã€‚</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="sd">    æ³¨æ„äº‹é¡¹:</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="sd">    - å¦‚è®ºæ–‡ä¸­æ‰€è¿°ï¼ŒLion éœ€è¦ä¸€ä¸ªæ›´å°çš„å­¦ä¹ ç‡ (lr)ã€‚</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="sd">    - ä¸ºäº†ç»´æŒæœ‰æ•ˆçš„æƒé‡è¡°å‡å¼ºåº¦ï¼Œéœ€è¦ä¸€ä¸ªæ›´å¤§çš„è§£è€¦æƒé‡è¡°å‡ (decoupled weight decay) å€¼ã€‚</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="sd">    - Lion çš„æ€§èƒ½å¢ç›Šä¼šéšç€æ‰¹å¤„ç†å¤§å° (batch size) çš„å¢åŠ è€Œå˜å¤§ã€‚</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="sd">    - æ­¤å¤–ï¼Œåœ¨ä¸€äº›å¤§å‹è¯­è¨€æ¨¡å‹å’Œæ–‡æœ¬/å›¾åƒæ•°æ®é›†ä¸Šï¼ŒLion å¹¶æœªè¢«å‘ç°èƒ½è¶…è¶Š AdamWã€‚</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="sd">    å‚æ•°:</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="sd">        params: éœ€è¦ä¼˜åŒ–çš„ã€å¯è¿­ä»£çš„å‚æ•°ï¼Œæˆ–å®šä¹‰äº†å‚æ•°ç»„çš„å­—å…¸ã€‚</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="sd">        lr: å­¦ä¹ ç‡ (learning rate)ï¼Œé»˜è®¤ä¸º 1e-4 (æ³¨æ„ï¼Œè®ºæ–‡å»ºè®®æ¯” Adam å° 3-10 å€)ã€‚</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="sd">        betas: ç”¨äºè®¡ç®—æ¢¯åº¦åŠå…¶å¹³æ–¹çš„è¿è¡Œå¹³å‡å€¼çš„ç³»æ•° (é»˜è®¤: (0.9, 0.99))ã€‚</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="sd">               åœ¨ Lion ä¸­ï¼Œbeta1 ç”¨äºæ’å€¼ï¼Œbeta2 ç”¨äºåŠ¨é‡æ›´æ–°ã€‚</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="sd">        weight_decay: æƒé‡è¡°å‡ (L2 æƒ©ç½šé¡¹) (é»˜è®¤: 0)ã€‚</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="sd">    ç¤ºä¾‹:</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="sd">        &gt;&gt;&gt; import torch_optimizer as optim</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="sd">        &gt;&gt;&gt; optimizer = optim.Lion(model.parameters(), lr=0.001)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="sd">        &gt;&gt;&gt; optimizer.zero_grad()</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="sd">        &gt;&gt;&gt; loss_fn(model(input), target).backward()</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="sd">        &gt;&gt;&gt; optimizer.step()</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="sd">    """</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>    <span class="c1"># ç±»çš„æ„é€ å‡½æ•°</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>        <span class="n">params</span><span class="p">:</span> <span class="n">Params</span><span class="p">,</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>        <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>          <span class="c1"># å­¦ä¹ ç‡</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a>        <span class="n">betas</span><span class="p">:</span> <span class="n">Betas2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="c1"># beta å‚æ•°</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>        <span class="n">weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># æƒé‡è¡°å‡ç³»æ•°</span>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>    <span class="p">):</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a>        <span class="c1"># --- è¾“å…¥å‚æ•°åˆæ³•æ€§æ£€æŸ¥ ---</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>        <span class="k">if</span> <span class="n">lr</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"æ— æ•ˆçš„å­¦ä¹ ç‡: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lr</span><span class="p">))</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">betas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a>                <span class="s2">"æ— æ•ˆçš„ beta å‚æ•° (ç´¢å¼• 0): </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">betas</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a>            <span class="p">)</span>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">betas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a>                <span class="s2">"æ— æ•ˆçš„ beta å‚æ•° (ç´¢å¼• 1): </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">betas</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a>            <span class="p">)</span>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a>        <span class="k">if</span> <span class="n">weight_decay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a>                <span class="s2">"æ— æ•ˆçš„ weight_decay å€¼: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_decay</span><span class="p">)</span>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a>            <span class="p">)</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a>        <span class="c1"># å°†è¶…å‚æ•°æ‰“åŒ…æˆä¸€ä¸ªå­—å…¸ï¼Œä½œä¸ºé»˜è®¤é…ç½®</span>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a>        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a>        <span class="c1"># è°ƒç”¨çˆ¶ç±» (Optimizer) çš„æ„é€ å‡½æ•°ï¼Œå®Œæˆåˆå§‹åŒ–</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
<a id="__codelineno-1-76" name="__codelineno-1-76"></a>
<a id="__codelineno-1-77" name="__codelineno-1-77"></a>    <span class="c1"># `@torch.no_grad()` æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒä¼šç¦ç”¨æ­¤å‡½æ•°å†…çš„æ¢¯åº¦è®¡ç®—ã€‚</span>
<a id="__codelineno-1-78" name="__codelineno-1-78"></a>    <span class="c1"># è¿™å¯¹äºä¼˜åŒ–å™¨æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ä¿®æ”¹å‚æ•°å€¼ï¼Œè€Œä¸æ˜¯åœ¨è®¡ç®—å…³äºè¿™äº›ä¿®æ”¹çš„æ¢¯åº¦ã€‚</span>
<a id="__codelineno-1-79" name="__codelineno-1-79"></a>    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<a id="__codelineno-1-80" name="__codelineno-1-80"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure</span><span class="p">:</span> <span class="n">OptLossClosure</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptFloat</span><span class="p">:</span>
<a id="__codelineno-1-81" name="__codelineno-1-81"></a><span class="w">        </span><span class="sa">r</span><span class="sd">"""æ‰§è¡Œå•æ­¥ä¼˜åŒ–ã€‚</span>
<a id="__codelineno-1-82" name="__codelineno-1-82"></a>
<a id="__codelineno-1-83" name="__codelineno-1-83"></a><span class="sd">        å‚æ•°:</span>
<a id="__codelineno-1-84" name="__codelineno-1-84"></a><span class="sd">            closure: ä¸€ä¸ªå¯ä»¥é‡æ–°è¯„ä¼°æ¨¡å‹å¹¶è¿”å›æŸå¤±çš„é—­åŒ…å‡½æ•° (å¯é€‰)ã€‚</span>
<a id="__codelineno-1-85" name="__codelineno-1-85"></a><span class="sd">        """</span>
<a id="__codelineno-1-86" name="__codelineno-1-86"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-1-87" name="__codelineno-1-87"></a>        <span class="c1"># å¦‚æœæä¾›äº†é—­åŒ…å‡½æ•° (closure)ï¼Œåˆ™æ‰§è¡Œå®ƒæ¥è®¡ç®—æŸå¤±ã€‚</span>
<a id="__codelineno-1-88" name="__codelineno-1-88"></a>        <span class="c1"># è¿™åœ¨æŸäº›ä¼˜åŒ–ç®—æ³•ï¼ˆå¦‚ L-BFGSï¼‰ä¸­å¾ˆå¸¸è§ï¼Œå¯ä»¥å¤šæ¬¡è¯„ä¼°æ¨¡å‹ã€‚</span>
<a id="__codelineno-1-89" name="__codelineno-1-89"></a>        <span class="k">if</span> <span class="n">closure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-1-90" name="__codelineno-1-90"></a>            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">enable_grad</span><span class="p">():</span> <span class="c1"># åœ¨é—­åŒ…å†…éœ€è¦ç¡®ä¿æ¢¯åº¦æ˜¯å¼€å¯çš„</span>
<a id="__codelineno-1-91" name="__codelineno-1-91"></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">closure</span><span class="p">()</span>
<a id="__codelineno-1-92" name="__codelineno-1-92"></a>
<a id="__codelineno-1-93" name="__codelineno-1-93"></a>        <span class="c1"># éå†æ‰€æœ‰çš„å‚æ•°ç»„ (param_groups)ï¼Œä¾‹å¦‚å¯ä»¥ä¸ºæ¨¡å‹çš„ä¸åŒéƒ¨åˆ†è®¾ç½®ä¸åŒçš„å­¦ä¹ ç‡</span>
<a id="__codelineno-1-94" name="__codelineno-1-94"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_groups</span><span class="p">:</span>
<a id="__codelineno-1-95" name="__codelineno-1-95"></a>            <span class="c1"># éå†å½“å‰å‚æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå‚æ•° (p)</span>
<a id="__codelineno-1-96" name="__codelineno-1-96"></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">"params"</span><span class="p">]:</span>
<a id="__codelineno-1-97" name="__codelineno-1-97"></a>                <span class="c1"># å¦‚æœå‚æ•°æ²¡æœ‰æ¢¯åº¦ (ä¾‹å¦‚ï¼Œåœ¨å†»ç»“å±‚ä¸­)ï¼Œåˆ™è·³è¿‡</span>
<a id="__codelineno-1-98" name="__codelineno-1-98"></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-1-99" name="__codelineno-1-99"></a>                    <span class="k">continue</span>
<a id="__codelineno-1-100" name="__codelineno-1-100"></a>
<a id="__codelineno-1-101" name="__codelineno-1-101"></a>                <span class="c1"># --- æ ¸å¿ƒç®—æ³•å¼€å§‹ ---</span>
<a id="__codelineno-1-102" name="__codelineno-1-102"></a>
<a id="__codelineno-1-103" name="__codelineno-1-103"></a>                <span class="c1"># 1. æ‰§è¡Œè§£è€¦æƒé‡è¡°å‡ (Decoupled Weight Decay)</span>
<a id="__codelineno-1-104" name="__codelineno-1-104"></a>                <span class="c1"># è¿™æ˜¯ä¸€ç§ L2 æ­£åˆ™åŒ–çš„å½¢å¼ï¼Œå®ƒç›´æ¥ä»å‚æ•°ä¸­å‡å»ä¸€ä¸ªä¸å…¶è‡ªèº«å¤§å°æˆæ­£æ¯”çš„å€¼ã€‚</span>
<a id="__codelineno-1-105" name="__codelineno-1-105"></a>                <span class="c1"># æ³¨æ„è¿™é‡Œçš„è¡°å‡é‡æ˜¯ `lr * weight_decay`ï¼Œä¸ AdamW ä¸åŒ (AdamW æ˜¯ `weight_decay`)ã€‚</span>
<a id="__codelineno-1-106" name="__codelineno-1-106"></a>                <span class="n">p</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s2">"weight_decay"</span><span class="p">])</span>
<a id="__codelineno-1-107" name="__codelineno-1-107"></a>
<a id="__codelineno-1-108" name="__codelineno-1-108"></a>                <span class="n">grad</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span>
<a id="__codelineno-1-109" name="__codelineno-1-109"></a>                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="c1"># è·å–è¯¥å‚æ•°çš„çŠ¶æ€å­—å…¸ï¼Œç”¨äºå­˜å‚¨åŠ¨é‡ç­‰ä¿¡æ¯</span>
<a id="__codelineno-1-110" name="__codelineno-1-110"></a>
<a id="__codelineno-1-111" name="__codelineno-1-111"></a>                <span class="c1"># 2. çŠ¶æ€åˆå§‹åŒ– (State Initialization)</span>
<a id="__codelineno-1-112" name="__codelineno-1-112"></a>                <span class="c1"># å¦‚æœä¸€ä¸ªå‚æ•°ç¬¬ä¸€æ¬¡è¢«ä¼˜åŒ–ï¼Œå…¶çŠ¶æ€å­—å…¸ `state` æ˜¯ç©ºçš„</span>
<a id="__codelineno-1-113" name="__codelineno-1-113"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-114" name="__codelineno-1-114"></a>                    <span class="c1"># åˆå§‹åŒ–åŠ¨é‡ (momentum)ï¼Œå‘½åä¸º `exp_avg` ä»¥ä¸ Adam ä¿æŒä¸€è‡´</span>
<a id="__codelineno-1-115" name="__codelineno-1-115"></a>                    <span class="c1"># åˆ›å»ºä¸€ä¸ªä¸å‚æ•° p å½¢çŠ¶ç›¸åŒã€å€¼å…¨ä¸º 0 çš„å¼ é‡</span>
<a id="__codelineno-1-116" name="__codelineno-1-116"></a>                    <span class="n">state</span><span class="p">[</span><span class="s2">"exp_avg"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-1-117" name="__codelineno-1-117"></a>
<a id="__codelineno-1-118" name="__codelineno-1-118"></a>                <span class="c1"># è·å–åŠ¨é‡å’Œ beta ç³»æ•°</span>
<a id="__codelineno-1-119" name="__codelineno-1-119"></a>                <span class="n">exp_avg</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">"exp_avg"</span><span class="p">]</span>
<a id="__codelineno-1-120" name="__codelineno-1-120"></a>                <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">"betas"</span><span class="p">]</span>
<a id="__codelineno-1-121" name="__codelineno-1-121"></a>
<a id="__codelineno-1-122" name="__codelineno-1-122"></a>                <span class="c1"># 3. è®¡ç®—ç”¨äºæ›´æ–°çš„æ’å€¼ (Interpolation for update)</span>
<a id="__codelineno-1-123" name="__codelineno-1-123"></a>                <span class="c1"># è¿™ä¸€æ­¥æ˜¯ Lion ç®—æ³•çš„æ ¸å¿ƒä¹‹ä¸€ã€‚å®ƒä½¿ç”¨ beta1 æ¥æ··åˆï¼ˆæ’å€¼ï¼‰æ—§çš„åŠ¨é‡å’Œå½“å‰çš„æ¢¯åº¦ã€‚</span>
<a id="__codelineno-1-124" name="__codelineno-1-124"></a>                <span class="c1"># å…¬å¼: c_t = Î²â‚ * m_t + (1 - Î²â‚) * g_t</span>
<a id="__codelineno-1-125" name="__codelineno-1-125"></a>                <span class="n">update</span> <span class="o">=</span> <span class="n">exp_avg</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">beta1</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta1</span><span class="p">)</span>
<a id="__codelineno-1-126" name="__codelineno-1-126"></a>
<a id="__codelineno-1-127" name="__codelineno-1-127"></a>                <span class="c1"># 4. å‚æ•°æ›´æ–° (Parameter Update)</span>
<a id="__codelineno-1-128" name="__codelineno-1-128"></a>                <span class="c1"># ä½¿ç”¨ `update` çš„ç¬¦å· (sign) æ¥æ›´æ–°å‚æ•°ã€‚</span>
<a id="__codelineno-1-129" name="__codelineno-1-129"></a>                <span class="c1"># `torch.sign(update)` ä¼šå¾—åˆ°ä¸€ä¸ªç”± -1, 0, 1 ç»„æˆçš„å¼ é‡ã€‚</span>
<a id="__codelineno-1-130" name="__codelineno-1-130"></a>                <span class="c1"># `p.add_(..., alpha=-lr)` ç­‰ä»·äº `p.data = p.data - lr * torch.sign(update)`ã€‚</span>
<a id="__codelineno-1-131" name="__codelineno-1-131"></a>                <span class="c1"># è¿™æ˜¯ "Sign Momentum" åç§°çš„ç”±æ¥ã€‚</span>
<a id="__codelineno-1-132" name="__codelineno-1-132"></a>                <span class="n">p</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">update</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=-</span><span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">])</span>
<a id="__codelineno-1-133" name="__codelineno-1-133"></a>
<a id="__codelineno-1-134" name="__codelineno-1-134"></a>                <span class="c1"># 5. æ›´æ–°åŠ¨é‡ (Momentum Update)</span>
<a id="__codelineno-1-135" name="__codelineno-1-135"></a>                <span class="c1"># è¿™ä¸€æ­¥ä½¿ç”¨ beta2 æ¥æ›´æ–°åŠ¨é‡ï¼Œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£åšå‡†å¤‡ã€‚</span>
<a id="__codelineno-1-136" name="__codelineno-1-136"></a>                <span class="c1"># å…¬å¼: m_{t+1} = Î²â‚‚ * m_t + (1 - Î²â‚‚) * g_t</span>
<a id="__codelineno-1-137" name="__codelineno-1-137"></a>                <span class="c1"># `exp_avg.mul_(beta2)`: å…ˆå°†æ—§åŠ¨é‡ä¹˜ä»¥ beta2</span>
<a id="__codelineno-1-138" name="__codelineno-1-138"></a>                <span class="c1"># `.add_(grad, alpha=1 - beta2)`: å†åŠ ä¸Š `(1 - beta2) * grad`</span>
<a id="__codelineno-1-139" name="__codelineno-1-139"></a>                <span class="n">exp_avg</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">beta2</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta2</span><span class="p">)</span>
<a id="__codelineno-1-140" name="__codelineno-1-140"></a>
<a id="__codelineno-1-141" name="__codelineno-1-141"></a>        <span class="c1"># è¿”å›æœ¬æ¬¡ step è®¡ç®—çš„æŸå¤±å€¼ï¼ˆå¦‚æœæä¾›äº†é—­åŒ…ï¼‰</span>
<a id="__codelineno-1-142" name="__codelineno-1-142"></a>        <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="muon">Muon<a class="headerlink" href="#muon" title="Permanent link">Â¶</a></h2>
<p>æœ€åè®©æˆ‘ä»¬ç¥­å‡º Muon ä¼˜åŒ–å™¨ï¼Œä¹Ÿå°±æ˜¯ Kimi-K2 æ¨¡å‹è®­ç»ƒä½¿ç”¨çš„ä¼˜åŒ–å™¨ã€‚è¿™ä¸€èŠ‚çš„æ’°å†™ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‚è€ƒäº†è‹å‰‘æ—çš„åšå®¢ã€‚</p>
<p>æˆ‘ä»¬è®¡åˆ’ä»ä¸¤æ¡è·¯çº¿â€œåŒ…æŠ„â€æ¨å¯¼ Muon ä¼˜åŒ–å™¨ã€‚</p>
<p>ç¬¬ä¸€æ¡æ€è·¯æ˜¯ Lion ä¼˜åŒ–å™¨çš„æ€è·¯ï¼Œæˆ–è€…è¯´æ˜¯ Rprop çš„æ€è·¯ã€‚æœ€å¼€å§‹å¯¹ Rprop çš„åˆ†æå»ºç«‹åœ¨å‚æ•°æ›´æ–°é‡æ˜¯ <span class="arithmatex">\(-\eta\dfrac{g}{\sqrt{\bar g^2}}\)</span> çš„åŸºç¡€ä¸Šï¼Œç„¶åéå¸¸æ­¦æ–­åœ°è®¤ä¸ºå¯¹äº<strong>çŸ©é˜µ</strong>è€Œè¨€ <span class="arithmatex">\(\dfrac{g}{\sqrt{\bar g^2}}=\mathrm{sign}(g)\)</span>ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬<strong>ä»è¡¨è¾¾å¼æœ¬èº«å‡ºå‘</strong>å‘¢ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬å›åˆ°æ¢¦å¼€å§‹çš„åœ°æ–¹ï¼ŒAdaGrad ä¼˜åŒ–å™¨çš„åˆè¡·æ˜¯è®¡ç®— <span class="arithmatex">\(\dfrac{g}{\sqrt{gg^\top}}\)</span>ã€‚è€ƒè™‘å•ä¸ª fc layerï¼ˆæ­£å¦‚æˆ‘ä»¬åœ¨ Shampoo ä¼˜åŒ–å™¨ä¸­åšçš„é‚£æ ·ï¼‰ï¼Œåˆ™ <span class="arithmatex">\(g\)</span> æ˜¯ä¸€ä¸ª <span class="arithmatex">\(n\times m\)</span> çš„çŸ©é˜µã€‚è¿™å¯å‘æˆ‘ä»¬è®¾è®¡è¿™æ ·ä¸€ä¸ª<strong>çŸ©é˜µç¬¦å·å‡½æ•°</strong>ï¼š<span class="arithmatex">\(\mathrm{msign}(M)=(MM^\top)^{-\frac 12}M\)</span>ã€‚</p>
<p>ä¾æ—§æ˜¯å’Œ Shampoo ä¼˜åŒ–å™¨ä¸€æ ·ï¼ŒçŸ©é˜µçš„é€† <span class="arithmatex">\(p\)</span> æ¬¡æ–¹æ ¹æ˜¯é€šè¿‡ SVD è®¡ç®—ï¼ˆå¾—åˆ°æ¨å¹¿ï¼‰çš„ã€‚ä¹Ÿå°±æ˜¯è€ƒè™‘ <span class="arithmatex">\(M=U\Sigma V^\top\)</span> åˆ™ <span class="arithmatex">\(M^{-\frac 1p}=U\Sigma^{-\frac 1p}V^\top\)</span>ã€‚</p>
<p>å¯¹ <span class="arithmatex">\(M\)</span> åš SVD ä¹Ÿå°±æ˜¯ <span class="arithmatex">\(M=U\Sigma V^\top\)</span>ï¼Œé‚£ä¹ˆï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    \mathrm{msign}(M)&amp;=(U\Sigma V^\top V\Sigma U^\top)^{-\frac 12}(U\Sigma V^\top)\\
    &amp;=(U\Sigma^2U^\top)^{-\frac 12}(U\Sigma V^\top)\\
    &amp;=U\Sigma^{-1}U^\top U\Sigma V^\top\\
    &amp;=U_{[:r]}V_{[:r]}^\top
\end{align*}
\]</div>
<p>å…¶ä¸­ <span class="arithmatex">\(r\)</span> ä¸º <span class="arithmatex">\(M\)</span> çš„å¥‡å¼‚å€¼ä¸ªæ•°ã€‚</p>
<p>åˆ©ç”¨è¿™ä¸ª<strong>çŸ©é˜µç¬¦å·å‡½æ•°</strong>ä»£æ›¿ Rprop çš„ç¬¦å·å‡½æ•°ï¼Œå¹¶å¼•å…¥åŠ¨é‡ï¼ˆä½†æ˜¯ï¼Œä¸åƒ Lion ä¸€æ ·æŠŠåŠ¨é‡çš„æ›´æ–°æ”¾åœ¨æœ€åï¼‰ï¼Œå°±å¾—åˆ° Muon ä¼˜åŒ–å™¨çš„æ›´æ–°å…¬å¼äº†ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    g_n&amp;=\nabla \mathcal{L}(x;\theta_{n-1})\\
    M_n&amp;=\beta M_{n-1}+g_n\\
    \theta_n&amp;=\theta_{n-1}-\eta\mathrm{msign}(M_n+\lambda \theta_{n-1})
\end{align*}
\]</div>
<p>è¿™é‡Œå’Œ Lion ä¸ä¸€æ ·çš„æ˜¯æŠŠæ­£åˆ™åŒ–è§£è€¦åˆ°äº†ç¬¦å·å‡½æ•°é‡Œé¢ã€‚</p>
<p>ç¬¬äºŒæ¡è·¯ï¼Œå¦‚æœæˆ‘ä»¬é‡æ–°å®¡è§† Shampoo ä¼˜åŒ–å™¨åœ¨ä¸€ä¸ª fc layer çš„æƒ…å†µï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    L_n &amp;= \beta L_{n-1} + g_n g_n^\top\\
R_n &amp;= \beta R_{n-1} + g_n^\top g_n\\
H^{-\frac 12}g&amp;=L^{- \frac 14}g_nR^{- \frac 14}
\end{align*}
\]</div>
<p>åœ¨ <span class="arithmatex">\(\beta=0\)</span> çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    L^{- \frac 14}gR^{- \frac 14}=(g_n g_n^\top)^{- \frac 14}g_n(g_n^\top g_n)^{- \frac 14}
\end{align*}
\]</div>
<p>å¯¹ <span class="arithmatex">\(g_n\)</span> åš SVD å³ <span class="arithmatex">\(g_n=U\Sigma V^\top\)</span>ï¼Œæ¥ç€æ¨å¼å­ï¼š</p>
<div class="arithmatex">\[
\begin{align*}
    L^{- \frac 14}gR^{- \frac 14}&amp;=(g_n g_n^\top)^{- \frac 14}g_n(g_n^\top g_n)^{- \frac 14}\\
    &amp;=(U\Sigma V^\top V\Sigma U^\top)^{- \frac 14}(U\Sigma V^\top)(V\Sigma U^\top U\Sigma V^\top)\\
    &amp;=(U\Sigma^2 U^\top)^{- \frac 14}(U\Sigma V^\top)(V\Sigma^2 V^\top)^{- \frac 14}\\
    &amp;=U\Sigma^{- \frac 12}\Sigma \Sigma^{- \frac 12} V^\top\\
    &amp;=\mathrm{msign}(g_n)
\end{align*}
\]</div>
<p>è¿™æ„å‘³ç€ Shampoo ä¹Ÿå†¥å†¥ä¸­ä½¿ç”¨äº† <span class="arithmatex">\(\mathrm{msign}\)</span> å‡½æ•°ï¼</p>
<p>åè§‚ Muon çš„æ˜¾å­˜å ç”¨å’Œ SGDM ä¸€æ ·ï¼Œä½†æ˜¯ç†è®ºä¸Šæ‰“åŒ…ç®—å‡ºäº† <span class="arithmatex">\(gg^\top\)</span>ï¼Œæ•ˆæœåº”è¯¥ä¼šç›¸å½“èµå•Šï¼</p>
<p>æˆ‘ä»¬çŸ¥é“ Shampoo ä¼˜åŒ–å™¨çš„ç›®æ ‡æ˜¯ä½¿ç”¨ Kronecker ç§¯é«˜æ•ˆä¼˜åŒ– Hessian è®¡ç®—ï¼Œæœ€ç»ˆè¿‘ä¼¼ <span class="arithmatex">\(gg^\top\)</span>ï¼›è€Œ Muon ä¸€ä¸ªæ‰“åŒ…å¤„ç†ï¼Œå°±éå¸¸é«˜æ•ˆåœ°è®¡ç®—å‡ºæ¥äº†â€¦â€¦å—ï¼Ÿ</p>
<p>æˆ‘ä»¬åªæ˜¯å¾—åˆ°äº†å‚æ•°æ›´æ–°æ—¶ï¼Œå¦‚æœæ¯ä¸€æ¬¡éƒ½è¦è®¡ç®— SVD çš„è¯ï¼Œé‚£ä»£ä»·ä»ç„¶æ˜¯ä¸å¯æ‰¿æ‹…çš„ã€‚è¿™ï¼Œä¾¿æ˜¯ Muon æœ€åä¸€ä¸ªå­— N (for Newton-Schulz) çš„å«ä¹‰ï¼</p>
<p>æˆ‘ä»¬ä¸ä½¿ç”¨ SVDï¼Œè€Œæ˜¯é‡‡ç”¨ <span class="arithmatex">\(\mathrm{msign}(M)=(MM^\top)^{-\frac 12}M\)</span> æ¥è®¡ç®—ã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬è¦è®¡ç®— <span class="arithmatex">\((MM^\top)^{-\frac 12}\)</span>ã€‚</p>
<p>Muon çš„ä½œè€…ä½¿ç”¨ Newton-Schulz è¿­ä»£æ¥è®¡ç®—è¿™ä¸ªçŸ©é˜µã€‚Newton-Schulz è¿­ä»£æ˜¯ä¸€ç§è¿­ä»£æ³•çŸ©é˜µæ±‚é€†ç®—æ³•ï¼Œä» <span class="arithmatex">\(AX=I\)</span> å¼€å§‹ç”¨ Newton æ³•ç±»ä¼¼çš„è¿­ä»£å¼å­é€æ­¥æ±‚è§£ <span class="arithmatex">\(X=A^{-1}\)</span>ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…¶å®æ˜¯ä» <span class="arithmatex">\(MM^\top=I\)</span> å¼€å§‹è¿›è¡Œè¿­ä»£ã€‚ä¹Ÿå°±æ˜¯å°† <span class="arithmatex">\((MM^\top)^{-\frac 12}\)</span> è¿‘ä¼¼æˆ <span class="arithmatex">\(MM^\top-I\)</span> çš„å¤šé¡¹å¼ã€‚å˜¿ï¼Œæˆ‘çŸ¥é“ä½ åœ¨æƒ³æ³°å‹’å±•å¼€çš„äº‹æƒ…ï¼Œä½†æ˜¯æƒ³æƒ³æˆ‘ä»¬æœ€å°/å¤§åŒ–çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœ€å¤§åŒ–æ­£å¼¦å’Œä¸‰æ¬¡å‡½æ•°çš„ç›¸ä¼¼åº¦ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨åŸºäºå‹’è®©å¾·å¤šé¡¹å¼çš„å‚…é‡Œå¶çº§æ•°æ¥å±•å¼€è€Œä¸æ˜¯ä½¿ç”¨æ³°å‹’å±•å¼€â€¦â€¦ï¼‰</p>
<p>æ‰€ä»¥åˆ«æ€¥ã€‚æˆ‘ä»¬è€ƒè™‘å±•å¼€åˆ°ä¸‰é¡¹ï¼Œä¹Ÿå°±æ˜¯</p>
<div class="arithmatex">\[
\mathrm{msign}(M)\approx aM+b(MM^\top)M+c(MM^\top)^2M
\]</div>
<p>æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æ˜¯ï¼šå°½å¯èƒ½å¯¹äºæ‰€æœ‰çš„ <span class="arithmatex">\(M\)</span> éƒ½å…·æœ‰æœ€å¿«çš„æ”¶æ•›é€Ÿåº¦ã€‚</p>
<p>æˆ‘ä»¬å¯¹ <span class="arithmatex">\(M\)</span> åšä¸€ä¸‹ SVDï¼Œä¹Ÿå°±æ˜¯</p>
<div class="arithmatex">\[
\begin{align*}
    \mathrm{msign}(M)&amp;=aU\Sigma V^\top+b(U\Sigma V^\top V\Sigma U^\top)(U\Sigma V^\top)+c(U\Sigma V^\top V\Sigma U^\top)^2(U\Sigma V^\top)\\
    &amp;=aU\Sigma V^\top+bU\Sigma^3V^\top+cU\Sigma^5V^\top\\
    &amp;=U(a\Sigma+b\Sigma^3+c\Sigma^5)V^\top
\end{align*}
\]</div>
<p>å¯¹äºå¥‡å¼‚å€¼çš„æ¯ä¸€é¡¹ <span class="arithmatex">\(\sigma\in(0,1]\)</span> è€Œè¨€ï¼Œæˆ‘ä»¬å…¶å®å¸Œæœ› <span class="arithmatex">\(a\sigma+b\sigma^3+c\sigma^5\)</span> èƒ½å¤Ÿåœ¨ <span class="arithmatex">\(k\)</span> æ¬¡è¿­ä»£ä¸­å°½é‡é€¼è¿‘ <span class="arithmatex">\(1\)</span>ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥è®¾è®¡é—®é¢˜äº†ï¼šå›ºå®šè¿­ä»£æ¬¡æ•° <span class="arithmatex">\(k\)</span>ï¼Œä»¤ <span class="arithmatex">\(f(x)=ax+bx^3+cx^5(x\in(0,1])\)</span>ï¼Œç„¶åæŸå¤±å‡½æ•°ä½¿ç”¨ MSEï¼š<span class="arithmatex">\(\mathcal{L}([1-f^{(k)}(x)]^2;a,b,c)\)</span>ï¼Œå¯»æ‰¾ <span class="arithmatex">\(a,b,c\)</span> ä½¿å¾— <span class="arithmatex">\(\mathcal{L}\)</span> æœ€å°ã€‚æˆ‘ä»¬é‡‡ç”¨ Adam æ¥è·‘ä¸€è·‘ã€‚</p>
<details>
<summary> ä¼˜åŒ–ä½¿ç”¨çš„ä»£ç </summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optim</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1"># --- 1. è®¾ç½®è¶…å‚æ•°å’Œå›ºå®šå€¼ ---</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>                <span class="c1"># å›ºå®šè¿­ä»£æ¬¡æ•°</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">5e-5</span> <span class="c1"># Adam ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="n">num_steps</span> <span class="o">=</span> <span class="mi">100000</span>     <span class="c1"># ä¼˜åŒ–æ­¥æ•°</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2048</span>    <span class="c1"># æ¯æ­¥ä¼˜åŒ–ä¸­é‡‡æ ·çš„ x çš„æ•°é‡</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="n">a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="n">b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="n">c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="c1"># --- 3. è®¾ç½®ä¼˜åŒ–å™¨ ---</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="c1"># ä½¿ç”¨ Adam ä¼˜åŒ–å™¨æ¥æ›´æ–° a, b, c</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="c1"># å­˜å‚¨å†å²è®°å½•ä»¥ä¾›å¯è§†åŒ–</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="n">loss_history</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="n">a_history</span><span class="p">,</span> <span class="n">b_history</span><span class="p">,</span> <span class="n">c_history</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"å¼€å§‹ä¼˜åŒ–... k=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, åˆå§‹å€¼ a=</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, c=</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="c1"># --- 4. ä¼˜åŒ–å¾ªç¯ ---</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a>    <span class="c1"># å°†æ¢¯åº¦æ¸…é›¶</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a>    <span class="c1"># å®šä¹‰ f(x)</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x_in</span><span class="p">):</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a>        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x_in</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x_in</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x_in</span><span class="o">**</span><span class="mi">5</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a>    <span class="c1"># åœ¨ (0, 1] åŒºé—´éšæœºé‡‡æ ·ä¸€ä¸ª mini-batch çš„ x</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a>    <span class="c1"># torch.rand ç”Ÿæˆ [0, 1) çš„å€¼ï¼Œå¯¹äºæˆ‘ä»¬çš„ç›®çš„æ¥è¯´è¶³å¤Ÿäº†</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>    <span class="c1"># è®¡ç®— f^(k)(x)</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a>    <span class="c1"># æœ€ç»ˆçš„è¾“å‡º</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>    <span class="n">f_k_x</span> <span class="o">=</span> <span class="n">y</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a>    <span class="c1"># å®šä¹‰ç›®æ ‡å€¼ (å…¨ä¸º 1 çš„å¼ é‡)</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">f_k_x</span><span class="p">)</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a>    <span class="c1"># è®¡ç®—æŸå¤±å‡½æ•° (MSE)</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">target</span> <span class="o">-</span> <span class="n">f_k_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a>    <span class="c1"># åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a>    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a>    <span class="c1"># ä½¿ç”¨ä¼˜åŒ–å™¨æ›´æ–°å‚æ•° a, b, c</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a>    <span class="c1"># è®°å½•å†å²æ•°æ®</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a>    <span class="n">loss_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a>    <span class="n">a_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a>    <span class="n">b_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a>    <span class="n">c_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a>    <span class="c1"># æ¯ 1000 æ­¥æ‰“å°ä¸€æ¬¡è¿›åº¦</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a>    <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">step</span> <span class="o">==</span> <span class="n">num_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Step </span><span class="si">{</span><span class="n">step</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num_steps</span><span class="p">))</span><span class="si">}}</span><span class="s2">: Loss = </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, "</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a>              <span class="sa">f</span><span class="s2">"a = </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, b = </span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, c = </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="c1"># --- 5. ç»“æœå±•ç¤º ---</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- ä¼˜åŒ–å®Œæˆ ---"</span><span class="p">)</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"å›ºå®šè¿­ä»£æ¬¡æ•° k = </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"æœ€ç»ˆæŸå¤±: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ä¼˜åŒ–åçš„å‚æ•°: a = </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, b = </span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, c = </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"å‚æ•°å’Œ a+b+c = </span><span class="si">{</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (ç†è®ºä¸Šåº”è¶‹è¿‘äº 1)"</span><span class="p">)</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a><span class="c1"># --- 6. å¯è§†åŒ– ---</span>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a><span class="c1"># ç»˜åˆ¶æŸå¤±å’Œå‚æ•°å€¼çš„å˜åŒ–è¿‡ç¨‹</span>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'seaborn-v0_8-whitegrid'</span><span class="p">)</span>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a><span class="c1"># ç»˜åˆ¶æŸå¤±å‡½æ•°</span>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss_history</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Loss (MSE)'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Loss and Parameter Evolution (k=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">)'</span><span class="p">)</span>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span> <span class="c1"># ä½¿ç”¨å¯¹æ•°åæ ‡è½´ä»¥ä¾¿è§‚å¯Ÿ</span>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a><span class="c1"># ç»˜åˆ¶å‚æ•° a, b, c</span>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a_history</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'-'</span><span class="p">)</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">b_history</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'b'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_history</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'c'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">':'</span><span class="p">)</span>
<a id="__codelineno-2-95" name="__codelineno-2-95"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Optimization Step'</span><span class="p">)</span>
<a id="__codelineno-2-96" name="__codelineno-2-96"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Parameter Value'</span><span class="p">)</span>
<a id="__codelineno-2-97" name="__codelineno-2-97"></a><span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-2-98" name="__codelineno-2-98"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-2-99" name="__codelineno-2-99"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-2-100" name="__codelineno-2-100"></a>
<a id="__codelineno-2-101" name="__codelineno-2-101"></a><span class="c1"># ç»˜åˆ¶ä¼˜åŒ–å‰åçš„å‡½æ•° f(x) å’Œ f^(k)(x)</span>
<a id="__codelineno-2-102" name="__codelineno-2-102"></a><span class="n">x_plot</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-103" name="__codelineno-2-103"></a>
<a id="__codelineno-2-104" name="__codelineno-2-104"></a><span class="c1"># ä¼˜åŒ–åçš„å‡½æ•°</span>
<a id="__codelineno-2-105" name="__codelineno-2-105"></a><span class="k">def</span><span class="w"> </span><span class="nf">f_final</span><span class="p">(</span><span class="n">x_in</span><span class="p">):</span>
<a id="__codelineno-2-106" name="__codelineno-2-106"></a>    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">*</span> <span class="n">x_in</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">*</span> <span class="n">x_in</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">*</span> <span class="n">x_in</span><span class="o">**</span><span class="mi">5</span>
<a id="__codelineno-2-107" name="__codelineno-2-107"></a>
<a id="__codelineno-2-108" name="__codelineno-2-108"></a><span class="c1"># åˆå§‹å‡½æ•°</span>
<a id="__codelineno-2-109" name="__codelineno-2-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">f_initial</span><span class="p">(</span><span class="n">x_in</span><span class="p">):</span>
<a id="__codelineno-2-110" name="__codelineno-2-110"></a>    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">x_in</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_in</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">x_in</span><span class="o">**</span><span class="mi">5</span>
<a id="__codelineno-2-111" name="__codelineno-2-111"></a>
<a id="__codelineno-2-112" name="__codelineno-2-112"></a><span class="c1"># è®¡ç®— k æ¬¡è¿­ä»£</span>
<a id="__codelineno-2-113" name="__codelineno-2-113"></a><span class="n">y_final_k</span> <span class="o">=</span> <span class="n">x_plot</span>
<a id="__codelineno-2-114" name="__codelineno-2-114"></a><span class="n">y_initial_k</span> <span class="o">=</span> <span class="n">x_plot</span>
<a id="__codelineno-2-115" name="__codelineno-2-115"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<a id="__codelineno-2-116" name="__codelineno-2-116"></a>    <span class="n">y_final_k</span> <span class="o">=</span> <span class="n">f_final</span><span class="p">(</span><span class="n">y_final_k</span><span class="p">)</span>
<a id="__codelineno-2-117" name="__codelineno-2-117"></a>    <span class="n">y_initial_k</span> <span class="o">=</span> <span class="n">f_initial</span><span class="p">(</span><span class="n">y_initial_k</span><span class="p">)</span>
<a id="__codelineno-2-118" name="__codelineno-2-118"></a>
<a id="__codelineno-2-119" name="__codelineno-2-119"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-2-120" name="__codelineno-2-120"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">f_initial</span><span class="p">(</span><span class="n">x_plot</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">'b--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Initial $f(x) = x-x^3+x^5$'</span><span class="p">)</span>
<a id="__codelineno-2-121" name="__codelineno-2-121"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">f_final</span><span class="p">(</span><span class="n">x_plot</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">'g-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'Optimized $f(x)$ (k=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">)'</span><span class="p">)</span>
<a id="__codelineno-2-122" name="__codelineno-2-122"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">y_final_k</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">'r-'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'Optimized $f^</span><span class="se">{{</span><span class="s1">(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">)</span><span class="se">}}</span><span class="s1">(x)$'</span><span class="p">)</span>
<a id="__codelineno-2-123" name="__codelineno-2-123"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">x_plot</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s1">'k:'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'$y=x$ (identity)'</span><span class="p">)</span>
<a id="__codelineno-2-124" name="__codelineno-2-124"></a><span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Target y=1'</span><span class="p">)</span>
<a id="__codelineno-2-125" name="__codelineno-2-125"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Comparison of Functions (k=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">)'</span><span class="p">)</span>
<a id="__codelineno-2-126" name="__codelineno-2-126"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'x'</span><span class="p">)</span>
<a id="__codelineno-2-127" name="__codelineno-2-127"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'f(x) or $f^{(k)}(x)$'</span><span class="p">)</span>
<a id="__codelineno-2-128" name="__codelineno-2-128"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-2-129" name="__codelineno-2-129"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-2-130" name="__codelineno-2-130"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-131" name="__codelineno-2-131"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<p>è¿™é‡Œæˆ‘é€‰æ‹©çš„åˆå§‹å€¼æ˜¯ä»»æ„é€‰å–çš„ <span class="arithmatex">\(a=1,b=-1,c=1\)</span> æ»¡è¶³ <span class="arithmatex">\(a+b+c=1\)</span>ï¼Œä¸‹é¢æ˜¯ï¼ˆæˆªæ–­çš„ï¼‰æ—¥å¿—è¾“å‡ºï¼š</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>å¼€å§‹ä¼˜åŒ–... k=5, åˆå§‹å€¼ a=1.00, b=-1.00, c=1.00
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>Step      0: Loss = 0.58154202, a = 1.0000, b = -0.9999, c = 1.0000
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>Step   1000: Loss = 0.52524936, a = 1.0461, b = -1.0118, c = 0.9704
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>Step   2000: Loss = 0.46161765, a = 1.0933, b = -1.0257, c = 0.9381
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>......
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>Step  99000: Loss = 0.00160778, a = 3.1010, b = -3.4233, c = 1.3183
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>Step  99999: Loss = 0.00136968, a = 3.1010, b = -3.4236, c = 1.3181
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>--- ä¼˜åŒ–å®Œæˆ ---
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>å›ºå®šè¿­ä»£æ¬¡æ•° k = 5
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>æœ€ç»ˆæŸå¤±: 0.00136968
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>ä¼˜åŒ–åçš„å‚æ•°: a = 3.1010, b = -3.4236, c = 1.3181
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>å‚æ•°å’Œ a+b+c = 0.9954 (ç†è®ºä¸Šåº”è¶‹è¿‘äº 1)
</code></pre></div></td></tr></table></div>
<p>MSE å¹²åˆ°äº† 1e-3 é‡çº§ã€‚ä¸‹é¢æ˜¯è®­ç»ƒè¿‡ç¨‹çš„æŸå¤±æ›²çº¿ã€å‚æ•°å˜åŒ–æ›²çº¿å’Œæœ€ç»ˆå‡½æ•°çš„æ‹Ÿåˆå›¾çº¿ï¼š</p>
<p><img alt="loss" src="../optimizer_pics/loss.png"/></p>
<p><img alt="curve" src="../optimizer_pics/curve.png"/></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æ‹¿ç‰›é¡¿æ³•è®­ï¼Œæ¯•ç«Ÿå°±ä¸‰ä¸ªå‚æ•°ï¼Œä½†æ˜¯æˆ‘è‡ªå·±å®æµ‹è®­ç»ƒä¸å¤§ç¨³å®šï¼Œæ—¶ä¸æ—¶å°±è®­ç‚¸äº†ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¿™æ˜¯ Muon ä½œè€…æå‡ºçš„å‚æ•°é…ç½®ï¼š<span class="arithmatex">\(a=3.4445,b=âˆ’4.7750,c=2.0315\)</span></p>
<p><img alt="curve_2" src="../optimizer_pics/curve_2.png"/></p>
<p>è¿™æ˜¯ Muon ä¼˜åŒ–å™¨åœ¨è¿™ä¸¤ä¸ªæŸå¤±åœ°å½¢ä¸‹é¢çš„è¡¨ç°ï¼š</p>
<p><img alt="rastrigin_Muon" src="../optimizer_pics/rastrigin_SingleDeviceMuon.gif"/></p>
<p><img alt="rosenbrock_Muon" src="../optimizer_pics/rosenbrock_SingleDeviceMuon.gif"/></p>
<p>ä½†æ˜¯ï¼Œç”±äºå±‚æ•°å’Œç»´åº¦æ¯”è¾ƒä½ï¼Œè¿™ä¸ªåœ°å½¢æ²¡æœ‰å‘æŒ¥å‡º Muon çš„ Newton-Schulz è¿­ä»£çœŸæ­£çš„æ½œåŠ›ï¼</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ Muon åœ¨ Fashion-MNIST ä¸Šé¢çš„æ€§èƒ½ï¼š</p>
<p>ä¸‹é¢æ˜¯å®˜æ–¹å‚æ•° <span class="arithmatex">\(a,b,c=(3.4445,âˆ’4.7750,2.0315)\)</span> çš„æŸå¤±æ›²çº¿ã€å‡†ç¡®ç‡å’Œæœ€ä¼˜é™„è¿‘çš„æŸå¤±åœ°å½¢ã€‚</p>
<p><img alt="SingleDeviceMuonWithAuxAdam_performance_curves" src="../optimizer_pics/SingleDeviceMuonWithAuxAdam_performance_curves.png"/></p>
<p><img alt="SingleDeviceMuonWithAuxAdam_landscape_pca" src="../optimizer_pics/SingleDeviceMuonWithAuxAdam_landscape_pca.png"/></p>
<p>ä¸‹é¢æ˜¯æˆ‘è‡ªå·±è·‘å‡ºæ¥çš„å‚æ•° <span class="arithmatex">\(a,b,c=(3.1010, -3.4236, 1.3181)\)</span> çš„æŸå¤±æ›²çº¿ã€å‡†ç¡®ç‡å’Œæœ€ä¼˜é™„è¿‘çš„æŸå¤±åœ°å½¢ã€‚ï¼ˆç”šè‡³ Hyperopt æœå‡ºæ¥çš„å­¦ä¹ ç‡éƒ½ä¸€æ ·ï¼‰</p>
<p><img alt="SingleDeviceMuonWithAuxAdam_performance_curves" src="../optimizer_pics/SingleDeviceMuonWithAuxAdam_performance_curves_my.png"/></p>
<p><img alt="SingleDeviceMuonWithAuxAdam_landscape_pca" src="../optimizer_pics/SingleDeviceMuonWithAuxAdam_landscape_pca_my.png"/></p>
<p>çœŸçš„ä¸æ˜¯åŒä¸€å¼ å›¾å“ˆï¼Œå¯ä»¥è‡ªè¡Œæ”¾å¤§å¯¹æ¯”ä¸€ä¸‹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ° Newton-Shculz è¿­ä»£éœ€è¦çš„è¿™ä¸ªå‚æ•°å®¹å·®è¿˜æ¯”è¾ƒå¤§ï¼Œåªè¦ä¸æ˜¯ç‰¹åˆ«ç¦»è°±ï¼Œæœ‰ç†æœ‰æ®æœç´¢å‡ºæ¥çš„å‚æ•°åŸºæœ¬ä¸Šæ•ˆæœéƒ½å·®ä¸å¤šã€‚</p>
<p>Muon åœ¨è¿™ä¸ªä»»åŠ¡ä¸Šé¢çš„è¡¨ç°å·²ç»åˆ°äº†é€†å¤©çš„æ°´å¹³äº†ã€‚ä¸åˆ° 2000 ä¸ª batch å°±èƒ½è®© train_loss é™åˆ° 0.1 å·¦å³ï¼Œè®© acc ä¸Šå‡åˆ° 0.9 ä¹Ÿåªç”¨äº†å¤§çº¦ 500 ä¸ª batchã€‚ç®€ç›´å¹²è¶´ä¸‹ä¹‹å‰ä¸€ä¼—ä¼˜åŒ–ç®—æ³•ã€‚</p>
<p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ Muon çš„ä»£ç ï¼ˆä¸ºå±•ç¤ºåŸç†è¿™é‡Œåªç»™å‡ºå•è®¾å¤‡çš„ï¼‰ï¼š</p>
<details>
<summary> Muon ä¼˜åŒ–å™¨çš„å®ç° </summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">  1</a></span>
<span class="normal"><a href="#__codelineno-4-2">  2</a></span>
<span class="normal"><a href="#__codelineno-4-3">  3</a></span>
<span class="normal"><a href="#__codelineno-4-4">  4</a></span>
<span class="normal"><a href="#__codelineno-4-5">  5</a></span>
<span class="normal"><a href="#__codelineno-4-6">  6</a></span>
<span class="normal"><a href="#__codelineno-4-7">  7</a></span>
<span class="normal"><a href="#__codelineno-4-8">  8</a></span>
<span class="normal"><a href="#__codelineno-4-9">  9</a></span>
<span class="normal"><a href="#__codelineno-4-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-4-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-4-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-4-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-4-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-4-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-4-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-4-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-4-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-4-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-4-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-4-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-4-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-4-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-4-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-4-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-4-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-4-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-4-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-4-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-4-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-4-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-4-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-4-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-4-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-4-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-4-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-4-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-4-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-4-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-4-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-4-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-4-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-4-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-4-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-4-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-4-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-4-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-4-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-4-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-4-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-4-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-4-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-4-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-4-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-4-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-4-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-4-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-4-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-4-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-4-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-4-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-4-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-4-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-4-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-4-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-4-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-4-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-4-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-4-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-4-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-4-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-4-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-4-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-4-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-4-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-4-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-4-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-4-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-4-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-4-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-4-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-4-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-4-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-4-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-4-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-4-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-4-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-4-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-4-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-4-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-4-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-4-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-4-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-4-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-4-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-4-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-4-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-4-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-4-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-4-100">100</a></span>
<span class="normal"><a href="#__codelineno-4-101">101</a></span>
<span class="normal"><a href="#__codelineno-4-102">102</a></span>
<span class="normal"><a href="#__codelineno-4-103">103</a></span>
<span class="normal"><a href="#__codelineno-4-104">104</a></span>
<span class="normal"><a href="#__codelineno-4-105">105</a></span>
<span class="normal"><a href="#__codelineno-4-106">106</a></span>
<span class="normal"><a href="#__codelineno-4-107">107</a></span>
<span class="normal"><a href="#__codelineno-4-108">108</a></span>
<span class="normal"><a href="#__codelineno-4-109">109</a></span>
<span class="normal"><a href="#__codelineno-4-110">110</a></span>
<span class="normal"><a href="#__codelineno-4-111">111</a></span>
<span class="normal"><a href="#__codelineno-4-112">112</a></span>
<span class="normal"><a href="#__codelineno-4-113">113</a></span>
<span class="normal"><a href="#__codelineno-4-114">114</a></span>
<span class="normal"><a href="#__codelineno-4-115">115</a></span>
<span class="normal"><a href="#__codelineno-4-116">116</a></span>
<span class="normal"><a href="#__codelineno-4-117">117</a></span>
<span class="normal"><a href="#__codelineno-4-118">118</a></span>
<span class="normal"><a href="#__codelineno-4-119">119</a></span>
<span class="normal"><a href="#__codelineno-4-120">120</a></span>
<span class="normal"><a href="#__codelineno-4-121">121</a></span>
<span class="normal"><a href="#__codelineno-4-122">122</a></span>
<span class="normal"><a href="#__codelineno-4-123">123</a></span>
<span class="normal"><a href="#__codelineno-4-124">124</a></span>
<span class="normal"><a href="#__codelineno-4-125">125</a></span>
<span class="normal"><a href="#__codelineno-4-126">126</a></span>
<span class="normal"><a href="#__codelineno-4-127">127</a></span>
<span class="normal"><a href="#__codelineno-4-128">128</a></span>
<span class="normal"><a href="#__codelineno-4-129">129</a></span>
<span class="normal"><a href="#__codelineno-4-130">130</a></span>
<span class="normal"><a href="#__codelineno-4-131">131</a></span>
<span class="normal"><a href="#__codelineno-4-132">132</a></span>
<span class="normal"><a href="#__codelineno-4-133">133</a></span>
<span class="normal"><a href="#__codelineno-4-134">134</a></span>
<span class="normal"><a href="#__codelineno-4-135">135</a></span>
<span class="normal"><a href="#__codelineno-4-136">136</a></span>
<span class="normal"><a href="#__codelineno-4-137">137</a></span>
<span class="normal"><a href="#__codelineno-4-138">138</a></span>
<span class="normal"><a href="#__codelineno-4-139">139</a></span>
<span class="normal"><a href="#__codelineno-4-140">140</a></span>
<span class="normal"><a href="#__codelineno-4-141">141</a></span>
<span class="normal"><a href="#__codelineno-4-142">142</a></span>
<span class="normal"><a href="#__codelineno-4-143">143</a></span>
<span class="normal"><a href="#__codelineno-4-144">144</a></span>
<span class="normal"><a href="#__codelineno-4-145">145</a></span>
<span class="normal"><a href="#__codelineno-4-146">146</a></span>
<span class="normal"><a href="#__codelineno-4-147">147</a></span>
<span class="normal"><a href="#__codelineno-4-148">148</a></span>
<span class="normal"><a href="#__codelineno-4-149">149</a></span>
<span class="normal"><a href="#__codelineno-4-150">150</a></span>
<span class="normal"><a href="#__codelineno-4-151">151</a></span>
<span class="normal"><a href="#__codelineno-4-152">152</a></span>
<span class="normal"><a href="#__codelineno-4-153">153</a></span>
<span class="normal"><a href="#__codelineno-4-154">154</a></span>
<span class="normal"><a href="#__codelineno-4-155">155</a></span>
<span class="normal"><a href="#__codelineno-4-156">156</a></span>
<span class="normal"><a href="#__codelineno-4-157">157</a></span>
<span class="normal"><a href="#__codelineno-4-158">158</a></span>
<span class="normal"><a href="#__codelineno-4-159">159</a></span>
<span class="normal"><a href="#__codelineno-4-160">160</a></span>
<span class="normal"><a href="#__codelineno-4-161">161</a></span>
<span class="normal"><a href="#__codelineno-4-162">162</a></span>
<span class="normal"><a href="#__codelineno-4-163">163</a></span>
<span class="normal"><a href="#__codelineno-4-164">164</a></span>
<span class="normal"><a href="#__codelineno-4-165">165</a></span>
<span class="normal"><a href="#__codelineno-4-166">166</a></span>
<span class="normal"><a href="#__codelineno-4-167">167</a></span>
<span class="normal"><a href="#__codelineno-4-168">168</a></span>
<span class="normal"><a href="#__codelineno-4-169">169</a></span>
<span class="normal"><a href="#__codelineno-4-170">170</a></span>
<span class="normal"><a href="#__codelineno-4-171">171</a></span>
<span class="normal"><a href="#__codelineno-4-172">172</a></span>
<span class="normal"><a href="#__codelineno-4-173">173</a></span>
<span class="normal"><a href="#__codelineno-4-174">174</a></span>
<span class="normal"><a href="#__codelineno-4-175">175</a></span>
<span class="normal"><a href="#__codelineno-4-176">176</a></span>
<span class="normal"><a href="#__codelineno-4-177">177</a></span>
<span class="normal"><a href="#__codelineno-4-178">178</a></span>
<span class="normal"><a href="#__codelineno-4-179">179</a></span>
<span class="normal"><a href="#__codelineno-4-180">180</a></span>
<span class="normal"><a href="#__codelineno-4-181">181</a></span>
<span class="normal"><a href="#__codelineno-4-182">182</a></span>
<span class="normal"><a href="#__codelineno-4-183">183</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="c1"># å¯¼å…¥ PyTorch åˆ†å¸ƒå¼è®­ç»ƒåº“</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch.distributed</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dist</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="c1"># --- æ ¸å¿ƒæ•°å­¦å‡½æ•° ---</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">zeropower_via_newtonschulz5</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="sd">    ä½¿ç”¨ç‰›é¡¿-èˆ’å°”èŒ¨è¿­ä»£è®¡ç®—çŸ©é˜µ G çš„é›¶æ¬¡å¹‚ï¼Œå³å¯¹ G è¿›è¡Œæ­£äº¤åŒ–ã€‚</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="sd">    æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªäº”æ¬¡è¿­ä»£ï¼Œå…¶ç³»æ•°ç»è¿‡ç²¾å¿ƒé€‰æ‹©ï¼Œä»¥æœ€å¤§åŒ–åœ¨é›¶ç‚¹å¤„çš„æ–œç‡ã€‚</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="sd">    ä¸ºäº†æœ€å°åŒ–è¿­ä»£æ­¥æ•°ï¼Œç»éªŒè¡¨æ˜ï¼Œå³ä½¿è¿­ä»£åœ¨åŒºé—´ä¸Šä¸å†å®Œå…¨æ”¶æ•›åˆ°1ï¼ŒæŒç»­å¢åŠ é›¶ç‚¹å¤„çš„æ–œç‡ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="sd">    å› æ­¤ï¼Œè¿™ä¸ªè¿­ä»£ä¸ä¼šç²¾ç¡®åœ°äº§ç”Ÿ UV^T (å…¶ä¸­ U å’Œ V æ˜¯æ­£äº¤çŸ©é˜µ)ï¼Œè€Œæ˜¯äº§ç”Ÿç±»ä¼¼ US'V^T çš„ä¸œè¥¿ï¼Œ</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="sd">    å…¶ä¸­ S' æ˜¯å¯¹è§’çŸ©é˜µï¼Œå…¶å¯¹è§’çº¿å…ƒç´  S'_{ii} å¤§çº¦åœ¨ Uniform(0.5, 1.5) åˆ†å¸ƒã€‚</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="sd">    äº‹å®è¯æ˜ï¼Œç›¸å¯¹äºç²¾ç¡®çš„ UV^Tï¼Œè¿™ç§è¿‘ä¼¼å®Œå…¨ä¸ä¼šæŸå®³æ¨¡å‹æ€§èƒ½ã€‚(å…¶ä¸­ USV^T = G æ˜¯ G çš„å¥‡å¼‚å€¼åˆ†è§£)ã€‚</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="sd">    """</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="c1"># G çš„ç»´åº¦å¿…é¡»è‡³å°‘ä¸º 2 (å³ä¸€ä¸ªçŸ©é˜µ)ã€‚æ”¯æŒæ‰¹å¤„ç†çŸ©é˜µã€‚</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="k">assert</span> <span class="n">G</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> 
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span class="c1"># äº”æ¬¡è¿­ä»£çš„é¢„è®¡ç®—ç³»æ•°</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.4445</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.7750</span><span class="p">,</span>  <span class="mf">2.0315</span><span class="p">)</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>    <span class="c1"># ä¸ºäº†è®¡ç®—æ•ˆç‡å’Œç¨³å®šæ€§ï¼Œå°†è¾“å…¥çŸ©é˜µè½¬æ¢ä¸º bfloat16 ç±»å‹</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">()</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>    <span class="c1"># å¦‚æœçŸ©é˜µæ˜¯â€œé«˜ç˜¦â€çš„ (è¡Œæ•° &gt; åˆ—æ•°)ï¼Œåˆ™è¿›è¡Œè½¬ç½®ã€‚</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="c1"># çŸ©é˜µä¹˜æ³•é€šå¸¸åœ¨â€œçŸ®èƒ–â€çŸ©é˜µä¸Šæ›´é«˜æ•ˆã€‚</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">G</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mT</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>    <span class="c1"># å…³é”®æ­¥éª¤ï¼šç¡®ä¿è°±èŒƒæ•° (spectral norm) æœ€å¤šä¸º 1ã€‚</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>    <span class="c1"># ç‰›é¡¿-èˆ’å°”èŒ¨è¿­ä»£çš„æ”¶æ•›æ€§è¦æ±‚è¾“å…¥çŸ©é˜µçš„è°±èŒƒæ•° &lt;= 1ã€‚</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>    <span class="c1"># è¿™é‡Œé€šè¿‡é™¤ä»¥å…¶è°±èŒƒæ•°ï¼ˆçŸ©é˜µçš„æœ€å¤§å¥‡å¼‚å€¼ï¼‰æ¥è¿›è¡Œå½’ä¸€åŒ–ã€‚</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>    <span class="c1"># æ‰§è¡ŒæŒ‡å®šæ­¥æ•°çš„ç‰›é¡¿-èˆ’å°”èŒ¨è¿­ä»£</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">X</span><span class="o">.</span><span class="n">mT</span>  <span class="c1"># è®¡ç®— X * X^T</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>        <span class="c1"># ä½¿ç”¨ä¼˜åŒ–çš„ç­–ç•¥è®¡ç®—äº”æ¬¡å¤šé¡¹å¼ï¼Œé¿å…é«˜æ¬¡å¹‚çš„ç›´æ¥è®¡ç®—</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">A</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">A</span> <span class="o">@</span> <span class="n">A</span> 
<a id="__codelineno-4-37" name="__codelineno-4-37"></a>        <span class="c1"># æ›´æ–° Xï¼Œå½¢å¼ä¸º X_{k+1} = p(X_k @ X_k^T) @ X_k</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">X</span> <span class="o">+</span> <span class="n">B</span> <span class="o">@</span> <span class="n">X</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a>    <span class="c1"># å¦‚æœä¹‹å‰è½¬ç½®äº†ï¼Œç°åœ¨è½¬ç½®å›æ¥</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a>    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">G</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-4-42" name="__codelineno-4-42"></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mT</span>
<a id="__codelineno-4-43" name="__codelineno-4-43"></a>
<a id="__codelineno-4-44" name="__codelineno-4-44"></a>    <span class="c1"># è¿”å›è¿‘ä¼¼æ­£äº¤åŒ–çš„çŸ©é˜µ</span>
<a id="__codelineno-4-45" name="__codelineno-4-45"></a>    <span class="k">return</span> <span class="n">X</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a>
<a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="c1"># --- Muon æ›´æ–°è§„åˆ™ ---</span>
<a id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">muon_update</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">ns_steps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nesterov</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="w">    </span><span class="sd">"""è®¡ç®—å•æ­¥çš„ Muon æ›´æ–°é‡"""</span>
<a id="__codelineno-4-51" name="__codelineno-4-51"></a>    <span class="c1"># 1. æ ‡å‡†çš„åŠ¨é‡æ›´æ–°ï¼šmomentum = beta * momentum + (1 - beta) * grad</span>
<a id="__codelineno-4-52" name="__codelineno-4-52"></a>    <span class="n">momentum</span><span class="o">.</span><span class="n">lerp_</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span>
<a id="__codelineno-4-53" name="__codelineno-4-53"></a>
<a id="__codelineno-4-54" name="__codelineno-4-54"></a>    <span class="c1"># 2. è®¡ç®—æ›´æ–°æ–¹å‘ï¼šå¦‚æœä½¿ç”¨ Nesterov åŠ¨é‡ï¼Œåˆ™ä¸º grad + beta * momentumï¼›å¦åˆ™å°±æ˜¯æ›´æ–°åçš„åŠ¨é‡ã€‚</span>
<a id="__codelineno-4-55" name="__codelineno-4-55"></a>    <span class="n">update</span> <span class="o">=</span> <span class="n">grad</span><span class="o">.</span><span class="n">lerp_</span><span class="p">(</span><span class="n">momentum</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="k">if</span> <span class="n">nesterov</span> <span class="k">else</span> <span class="n">momentum</span>
<a id="__codelineno-4-56" name="__codelineno-4-56"></a>
<a id="__codelineno-4-57" name="__codelineno-4-57"></a>    <span class="c1"># 3. å¤„ç†å·ç§¯æ ¸ï¼šå¦‚æœæ›´æ–°å¯¹è±¡æ˜¯4Dçš„å·ç§¯æ ¸ (out, in, h, w)ï¼Œ</span>
<a id="__codelineno-4-58" name="__codelineno-4-58"></a>    <span class="c1">#    åˆ™å°†å…¶å±•å¹³ä¸º2DçŸ©é˜µ (out, in*h*w)ï¼Œä»¥ä¾¿è¿›è¡Œæ­£äº¤åŒ–ã€‚</span>
<a id="__codelineno-4-59" name="__codelineno-4-59"></a>    <span class="k">if</span> <span class="n">update</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> 
<a id="__codelineno-4-60" name="__codelineno-4-60"></a>        <span class="n">update</span> <span class="o">=</span> <span class="n">update</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">update</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-61" name="__codelineno-4-61"></a>
<a id="__codelineno-4-62" name="__codelineno-4-62"></a>    <span class="c1"># 4. æ ¸å¿ƒæ­¥éª¤ï¼šå°†è®¡ç®—å‡ºçš„æ›´æ–°æ–¹å‘è¿›è¡Œæ­£äº¤åŒ–ã€‚</span>
<a id="__codelineno-4-63" name="__codelineno-4-63"></a>    <span class="n">update</span> <span class="o">=</span> <span class="n">zeropower_via_newtonschulz5</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">ns_steps</span><span class="p">)</span>
<a id="__codelineno-4-64" name="__codelineno-4-64"></a>
<a id="__codelineno-4-65" name="__codelineno-4-65"></a>    <span class="c1"># 5. å°ºå¯¸ç¼©æ”¾ï¼šæ ¹æ®çŸ©é˜µçš„å½¢çŠ¶è¿›è¡Œç¼©æ”¾ï¼Œä»¥ä¿æŒæ›´æ–°çš„è°±èŒƒæ•°å•ä½ä¸€è‡´ã€‚</span>
<a id="__codelineno-4-66" name="__codelineno-4-66"></a>    <span class="n">update</span> <span class="o">*=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">grad</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">grad</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
<a id="__codelineno-4-67" name="__codelineno-4-67"></a>    <span class="k">return</span> <span class="n">update</span>
<a id="__codelineno-4-68" name="__codelineno-4-68"></a>
<a id="__codelineno-4-69" name="__codelineno-4-69"></a><span class="c1"># --- Muon ä¼˜åŒ–å™¨ (å•è®¾å¤‡ç‰ˆæœ¬) ---</span>
<a id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="k">class</span><span class="w"> </span><span class="nc">SingleDeviceMuon</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">):</span>
<a id="__codelineno-4-71" name="__codelineno-4-71"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-4-72" name="__codelineno-4-72"></a><span class="sd">    ç”¨äºéåˆ†å¸ƒå¼è®¾ç½®çš„ Muon å˜ä½“ã€‚</span>
<a id="__codelineno-4-73" name="__codelineno-4-73"></a><span class="sd">    """</span>
<a id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="w">        </span><span class="sd">"""</span>
<a id="__codelineno-4-75" name="__codelineno-4-75"></a><span class="sd">    Muon - é€šè¿‡ç‰›é¡¿-èˆ’å°”èŒ¨æ­£äº¤åŒ–çš„åŠ¨é‡ä¼˜åŒ–å™¨</span>
<a id="__codelineno-4-76" name="__codelineno-4-76"></a>
<a id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="sd">    Muon å†…éƒ¨è¿è¡Œæ ‡å‡†çš„ SGD-momentum, ç„¶åæ‰§è¡Œä¸€ä¸ªæ­£äº¤åŒ–åå¤„ç†æ­¥éª¤ï¼Œ</span>
<a id="__codelineno-4-78" name="__codelineno-4-78"></a><span class="sd">    å…¶ä¸­æ¯ä¸ª 2D å‚æ•°çš„æ›´æ–°è¢«æ›¿æ¢ä¸ºæœ€è¿‘çš„æ­£äº¤çŸ©é˜µã€‚</span>
<a id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="sd">    æˆ‘ä»¬ä½¿ç”¨ç‰›é¡¿-èˆ’å°”èŒ¨è¿­ä»£æ¥é«˜æ•ˆåœ°è¿›è¡Œæ­£äº¤åŒ–ï¼Œå…¶ä¼˜ç‚¹æ˜¯å¯ä»¥åœ¨ GPU ä¸Šç¨³å®šåœ°ä»¥ bfloat16 è¿è¡Œã€‚</span>
<a id="__codelineno-4-80" name="__codelineno-4-80"></a>
<a id="__codelineno-4-81" name="__codelineno-4-81"></a><span class="sd">    Muon åªåº”ç”¨äºéšè—å±‚çš„æƒé‡ã€‚è¾“å…¥åµŒå…¥ã€æœ€ç»ˆè¾“å‡ºå±‚ä»¥åŠä»»ä½•å†…éƒ¨çš„å¢ç›Šæˆ–åç½®é¡¹</span>
<a id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="sd">    åº”ä½¿ç”¨æ ‡å‡†æ–¹æ³•ï¼ˆå¦‚ AdamWï¼‰è¿›è¡Œä¼˜åŒ–ã€‚</span>
<a id="__codelineno-4-83" name="__codelineno-4-83"></a><span class="sd">    éšè—çš„å·ç§¯æƒé‡å¯ä»¥é€šè¿‡å°†å…¶è§†ä¸º 2D å¹¶æŠ˜å å…¶æœ€å3ä¸ªç»´åº¦æ¥ä½¿ç”¨ Muon è¿›è¡Œè®­ç»ƒã€‚</span>
<a id="__codelineno-4-84" name="__codelineno-4-84"></a>
<a id="__codelineno-4-85" name="__codelineno-4-85"></a><span class="sd">    å‚æ•°:</span>
<a id="__codelineno-4-86" name="__codelineno-4-86"></a><span class="sd">        lr: å­¦ä¹ ç‡ï¼Œå•ä½æ˜¯æ¯æ¬¡æ›´æ–°çš„è°±èŒƒæ•°ã€‚</span>
<a id="__codelineno-4-87" name="__codelineno-4-87"></a><span class="sd">        weight_decay: AdamW é£æ ¼çš„æƒé‡è¡°å‡ã€‚</span>
<a id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="sd">        momentum: åŠ¨é‡ç³»æ•°ï¼Œé€šå¸¸ 0.95 æ•ˆæœä¸é”™ã€‚</span>
<a id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="sd">    """</span>
<a id="__codelineno-4-90" name="__codelineno-4-90"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
<a id="__codelineno-4-91" name="__codelineno-4-91"></a>        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>
<a id="__codelineno-4-92" name="__codelineno-4-92"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
<a id="__codelineno-4-93" name="__codelineno-4-93"></a>
<a id="__codelineno-4-94" name="__codelineno-4-94"></a>    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<a id="__codelineno-4-95" name="__codelineno-4-95"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-4-96" name="__codelineno-4-96"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-97" name="__codelineno-4-97"></a>        <span class="k">if</span> <span class="n">closure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-98" name="__codelineno-4-98"></a>            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">enable_grad</span><span class="p">():</span>
<a id="__codelineno-4-99" name="__codelineno-4-99"></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">closure</span><span class="p">()</span>
<a id="__codelineno-4-100" name="__codelineno-4-100"></a>
<a id="__codelineno-4-101" name="__codelineno-4-101"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_groups</span><span class="p">:</span>
<a id="__codelineno-4-102" name="__codelineno-4-102"></a>            <span class="c1"># é€»è¾‘ä¸åˆ†å¸ƒå¼ç‰ˆæœ¬ç›¸åŒï¼Œä½†æ²¡æœ‰äº†å¤æ‚çš„åˆ†å¸ƒå¼é€šä¿¡ä»£ç </span>
<a id="__codelineno-4-103" name="__codelineno-4-103"></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">"params"</span><span class="p">]:</span>
<a id="__codelineno-4-104" name="__codelineno-4-104"></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-105" name="__codelineno-4-105"></a>                    <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-106" name="__codelineno-4-106"></a>                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
<a id="__codelineno-4-107" name="__codelineno-4-107"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-108" name="__codelineno-4-108"></a>                    <span class="n">state</span><span class="p">[</span><span class="s2">"momentum_buffer"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-109" name="__codelineno-4-109"></a>                <span class="n">update</span> <span class="o">=</span> <span class="n">muon_update</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s2">"momentum_buffer"</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s2">"momentum"</span><span class="p">])</span>
<a id="__codelineno-4-110" name="__codelineno-4-110"></a>                <span class="n">p</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s2">"weight_decay"</span><span class="p">])</span>
<a id="__codelineno-4-111" name="__codelineno-4-111"></a>                <span class="n">p</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">update</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=-</span><span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">])</span>
<a id="__codelineno-4-112" name="__codelineno-4-112"></a>
<a id="__codelineno-4-113" name="__codelineno-4-113"></a>        <span class="k">return</span> <span class="n">loss</span>
<a id="__codelineno-4-114" name="__codelineno-4-114"></a>
<a id="__codelineno-4-115" name="__codelineno-4-115"></a><span class="c1"># --- Adam æ›´æ–°è§„åˆ™ (è¾…åŠ©å‡½æ•°) ---</span>
<a id="__codelineno-4-116" name="__codelineno-4-116"></a><span class="k">def</span><span class="w"> </span><span class="nf">adam_update</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">buf1</span><span class="p">,</span> <span class="n">buf2</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
<a id="__codelineno-4-117" name="__codelineno-4-117"></a><span class="w">    </span><span class="sd">"""æ ‡å‡†çš„ Adam æ›´æ–°è§„åˆ™"""</span>
<a id="__codelineno-4-118" name="__codelineno-4-118"></a>    <span class="c1"># æ›´æ–°ä¸€é˜¶çŸ© (åŠ¨é‡)</span>
<a id="__codelineno-4-119" name="__codelineno-4-119"></a>    <span class="n">buf1</span><span class="o">.</span><span class="n">lerp_</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">betas</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-4-120" name="__codelineno-4-120"></a>    <span class="c1"># æ›´æ–°äºŒé˜¶çŸ© (RMSProp éƒ¨åˆ†)</span>
<a id="__codelineno-4-121" name="__codelineno-4-121"></a>    <span class="n">buf2</span><span class="o">.</span><span class="n">lerp_</span><span class="p">(</span><span class="n">grad</span><span class="o">.</span><span class="n">square</span><span class="p">(),</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">betas</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-4-122" name="__codelineno-4-122"></a>    <span class="c1"># åå·®ä¿®æ­£</span>
<a id="__codelineno-4-123" name="__codelineno-4-123"></a>    <span class="n">buf1c</span> <span class="o">=</span> <span class="n">buf1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">betas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-4-124" name="__codelineno-4-124"></a>    <span class="n">buf2c</span> <span class="o">=</span> <span class="n">buf2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">betas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-4-125" name="__codelineno-4-125"></a>    <span class="c1"># è®¡ç®—æ›´æ–°é‡</span>
<a id="__codelineno-4-126" name="__codelineno-4-126"></a>    <span class="k">return</span> <span class="n">buf1c</span> <span class="o">/</span> <span class="p">(</span><span class="n">buf2c</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-4-127" name="__codelineno-4-127"></a>
<a id="__codelineno-4-128" name="__codelineno-4-128"></a><span class="c1"># --- æ··åˆä¼˜åŒ–å™¨ (å•è®¾å¤‡ç‰ˆæœ¬) ---</span>
<a id="__codelineno-4-129" name="__codelineno-4-129"></a><span class="k">class</span><span class="w"> </span><span class="nc">SingleDeviceMuonWithAuxAdam</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">):</span>
<a id="__codelineno-4-130" name="__codelineno-4-130"></a><span class="w">    </span><span class="sd">"""</span>
<a id="__codelineno-4-131" name="__codelineno-4-131"></a><span class="sd">    MuonWithAuxAdam çš„éåˆ†å¸ƒå¼ç‰ˆæœ¬ã€‚</span>
<a id="__codelineno-4-132" name="__codelineno-4-132"></a><span class="sd">    """</span>
<a id="__codelineno-4-133" name="__codelineno-4-133"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_groups</span><span class="p">):</span>
<a id="__codelineno-4-134" name="__codelineno-4-134"></a>        <span class="c1"># åˆå§‹åŒ–é€»è¾‘ä¸åˆ†å¸ƒå¼ç‰ˆæœ¬ç›¸åŒ</span>
<a id="__codelineno-4-135" name="__codelineno-4-135"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">param_groups</span><span class="p">:</span>
<a id="__codelineno-4-136" name="__codelineno-4-136"></a>            <span class="k">assert</span> <span class="s2">"use_muon"</span> <span class="ow">in</span> <span class="n">group</span>
<a id="__codelineno-4-137" name="__codelineno-4-137"></a>            <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s2">"use_muon"</span><span class="p">]:</span>
<a id="__codelineno-4-138" name="__codelineno-4-138"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"lr"</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<a id="__codelineno-4-139" name="__codelineno-4-139"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"momentum"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"momentum"</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
<a id="__codelineno-4-140" name="__codelineno-4-140"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"weight_decay"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"weight_decay"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-141" name="__codelineno-4-141"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-142" name="__codelineno-4-142"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"lr"</span><span class="p">,</span> <span class="mf">3e-4</span><span class="p">)</span>
<a id="__codelineno-4-143" name="__codelineno-4-143"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"betas"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"betas"</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">))</span>
<a id="__codelineno-4-144" name="__codelineno-4-144"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"eps"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"eps"</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">)</span>
<a id="__codelineno-4-145" name="__codelineno-4-145"></a>                <span class="n">group</span><span class="p">[</span><span class="s2">"weight_decay"</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"weight_decay"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-146" name="__codelineno-4-146"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">param_groups</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
<a id="__codelineno-4-147" name="__codelineno-4-147"></a>
<a id="__codelineno-4-148" name="__codelineno-4-148"></a>    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<a id="__codelineno-4-149" name="__codelineno-4-149"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-4-150" name="__codelineno-4-150"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-151" name="__codelineno-4-151"></a>        <span class="k">if</span> <span class="n">closure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-152" name="__codelineno-4-152"></a>            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">enable_grad</span><span class="p">():</span>
<a id="__codelineno-4-153" name="__codelineno-4-153"></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">closure</span><span class="p">()</span>
<a id="__codelineno-4-154" name="__codelineno-4-154"></a>
<a id="__codelineno-4-155" name="__codelineno-4-155"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_groups</span><span class="p">:</span>
<a id="__codelineno-4-156" name="__codelineno-4-156"></a>            <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s2">"use_muon"</span><span class="p">]:</span>
<a id="__codelineno-4-157" name="__codelineno-4-157"></a>                <span class="c1"># å•è®¾å¤‡ Muon æ›´æ–°é€»è¾‘</span>
<a id="__codelineno-4-158" name="__codelineno-4-158"></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">"params"</span><span class="p">]:</span>
<a id="__codelineno-4-159" name="__codelineno-4-159"></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-160" name="__codelineno-4-160"></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-161" name="__codelineno-4-161"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
<a id="__codelineno-4-162" name="__codelineno-4-162"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-163" name="__codelineno-4-163"></a>                        <span class="n">state</span><span class="p">[</span><span class="s2">"momentum_buffer"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-164" name="__codelineno-4-164"></a>                    <span class="n">update</span> <span class="o">=</span> <span class="n">muon_update</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s2">"momentum_buffer"</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s2">"momentum"</span><span class="p">])</span>
<a id="__codelineno-4-165" name="__codelineno-4-165"></a>                    <span class="n">p</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s2">"weight_decay"</span><span class="p">])</span>
<a id="__codelineno-4-166" name="__codelineno-4-166"></a>                    <span class="n">p</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">update</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=-</span><span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">])</span>
<a id="__codelineno-4-167" name="__codelineno-4-167"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-168" name="__codelineno-4-168"></a>                <span class="c1"># å•è®¾å¤‡ AdamW æ›´æ–°é€»è¾‘</span>
<a id="__codelineno-4-169" name="__codelineno-4-169"></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">"params"</span><span class="p">]:</span>
<a id="__codelineno-4-170" name="__codelineno-4-170"></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-171" name="__codelineno-4-171"></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-172" name="__codelineno-4-172"></a>                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
<a id="__codelineno-4-173" name="__codelineno-4-173"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-174" name="__codelineno-4-174"></a>                        <span class="n">state</span><span class="p">[</span><span class="s2">"exp_avg"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-175" name="__codelineno-4-175"></a>                        <span class="n">state</span><span class="p">[</span><span class="s2">"exp_avg_sq"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-4-176" name="__codelineno-4-176"></a>                        <span class="n">state</span><span class="p">[</span><span class="s2">"step"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-177" name="__codelineno-4-177"></a>                    <span class="n">state</span><span class="p">[</span><span class="s2">"step"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-4-178" name="__codelineno-4-178"></a>                    <span class="n">update</span> <span class="o">=</span> <span class="n">adam_update</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s2">"exp_avg"</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s2">"exp_avg_sq"</span><span class="p">],</span>
<a id="__codelineno-4-179" name="__codelineno-4-179"></a>                                         <span class="n">state</span><span class="p">[</span><span class="s2">"step"</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="s2">"betas"</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="s2">"eps"</span><span class="p">])</span>
<a id="__codelineno-4-180" name="__codelineno-4-180"></a>                    <span class="n">p</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s2">"weight_decay"</span><span class="p">])</span>
<a id="__codelineno-4-181" name="__codelineno-4-181"></a>                    <span class="n">p</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="n">group</span><span class="p">[</span><span class="s2">"lr"</span><span class="p">])</span>
<a id="__codelineno-4-182" name="__codelineno-4-182"></a>
<a id="__codelineno-4-183" name="__codelineno-4-183"></a>        <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="admonition info">
<p class="admonition-title">ğŸ“ å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡</p>
<p>Yan Li. (Sep. 1, 2025). ç¬¦å·æ¢¯åº¦ä¸‹é™ [Blog post]. Retrieved from <a href="https://dicaeopolis.github.io/DNN/optimizer/SignGD">https://dicaeopolis.github.io/DNN/optimizer/SignGD</a></p>
<p>åœ¨ BibTeX æ ¼å¼ä¸­ï¼š
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>@online{SignGD,
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    title={ç¬¦å·æ¢¯åº¦ä¸‹é™},
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>    author={Yan Li},
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    year={2025},
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>    month={Sep},
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>    url={\url{https://dicaeopolis.github.io/DNN/optimizer/SignGD}},
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>}
</code></pre></div></td></tr></table></div></p>
</div>
<form class="md-feedback" hidden="" name="feedback">
<fieldset>
<legend class="md-feedback__title">
        Was this page helpful?
      </legend>
<div class="md-feedback__inner">
<div class="md-feedback__list">
<button class="md-feedback__icon md-icon" data-md-value="1" title="This page was helpful" type="submit">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"></path></svg>
</button>
<button class="md-feedback__icon md-icon" data-md-value="0" title="This page could be improved" type="submit">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"></path></svg>
</button>
</div>
<div class="md-feedback__note">
<div data-md-value="1" hidden="">
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
<div data-md-value="0" hidden="">
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="..." rel="noopener" target="_blank">feedback form</a>.
            </div>
</div>
</div>
</fieldset>
</form>
<h2 id="__comments">è¯„è®º</h2>
<!-- Giscus è„šæœ¬ç²˜è´´åœ¨è¿™é‡Œ -->
<script async="" crossorigin="anonymous" data-category="Comments" data-category-id="DIC_kwDOOfbpCM4CtuiH" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="dicaeopolis/dicaeopolis.github.io" data-repo-id="R_kgDOOfbpCA" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
<!-- è¿™æ®µè„šæœ¬ç”¨äºåŒæ­¥ Giscus å’Œ mkdocs-material çš„ä¸»é¢˜ -->
<script>
    var giscus = document.querySelector("script[src*=giscus]");
    document.addEventListener("DOMContentLoaded", function () {
      var palette = __md_get("__palette");
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "transparent_dark" : "light";
        giscus.setAttribute("data-theme", theme);
      }
      var ref = document.querySelector("[data-md-component=palette]");
      ref.addEventListener("change", function () {
        var palette = __md_get("__palette");
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "transparent_dark" : "light";
          var message = { setConfig: { theme: theme } };
          var frame = document.querySelector(".giscus-frame");
          frame.contentWindow.postMessage({ giscus: message }, "https://giscus.app");
        }
      });
    });
  </script>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.copy", "content.code.select", "navigation.titles", "navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="../../../assets/js/custom.js"></script>
<script src="../../../themes/js/custom.js"></script>
<script src="../../../themes/js/simpleLightbox.min.js"></script>
<script src="../../../themes/js/optionalConfig.js"></script>
<script src="../../../themes/js/mermaidloader.js"></script>
<script src="../../../themes/js/umlconvert.js"></script>
<script src="../../../themes/js/mathjax.js"></script>
<script src="../../../themes/js/katex.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.17.1/flowchart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.6/underscore-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mermaid-js/mermaid-mindmap@9.3.0/dist/diagram-definition.0faef4c2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-plantuml@1.4.1/index.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml-full.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
</body>
</html>